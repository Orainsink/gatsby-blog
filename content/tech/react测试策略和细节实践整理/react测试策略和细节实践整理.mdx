---
categories: tech
description: æ•´ç†reactæµ‹è¯•ç­–ç•¥å’Œä¸€äº›åœºæ™¯çš„æœ€ä½³å®è·µ
date: 2022-03-21 11:34:41
title: reactæµ‹è¯•ç­–ç•¥å’Œæœ€ä½³å®è·µæ•´ç†
tags: [react, æµ‹è¯•, æ¶æ„, è§„èŒƒ]
---

> æµ‹è¯•æ˜¯æ•æ·å¼€å‘å¾ˆé‡è¦çš„ä¸€ç¯ï¼Œä½†æ˜¯å®é™…å·¥ä½œä¸­å†™æµ‹è¯•å¾€å¾€ä¼´éšç€ç—›è‹¦ï¼Œéšæ—¶å˜åŠ¨çš„éœ€æ±‚å’Œç¿»å€çš„å¼€å‘å·¥æ—¶ä»¥åŠéº»çƒ¦çš„ UI å•å…ƒæµ‹è¯•è®©å¤§éƒ¨åˆ†å‰ç«¯å¯¹å†™æµ‹è¯•æœ›è€Œå´æ­¥ã€‚ï¼ˆTDDï¼Ÿå¯ä»¥æœ‰ TDD çš„æ„è¯†ï¼Œä½†å®è·µ TDD çš„æ—¶é—´ï¼Œåˆ«äººéƒ½ä¸‹ç­å›å®¶æŠ±å¨ƒäº†ï¼‰
>
> å¦‚æœå¼€å‘å·¥æ—¶å……è£•ï¼Œæµ‹è¯•è¦†ç›–é‡å¤§ç®¡é¥±ï¼Œæ‹‰åˆ° 99%æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ã€‚å½“é¢å¯¹å·¥æœŸåƒç´§ï¼Œé¡¹ç›®å¤æ‚åº¦é«˜ï¼Œè¿­ä»£å‘¨æœŸé•¿ï¼Œäººå‘˜æµåŠ¨é¢‘ç¹çš„é¡¹ç›®çš„æ—¶å€™ï¼Œå†™ä¸€äº›æ¯«æ— æ„ä¹‰çš„æµ‹è¯•æ˜¯åœ¨æµªè´¹è‡ªå·±å’Œé¡¹ç›®çš„ç”Ÿå‘½ï¼Œä½†ä¸å†™æµ‹è¯•åˆ™æ˜¯åˆ åº“è·‘è·¯çº§åˆ«çš„ä¸è´Ÿè´£ä»»ã€‚
>
> æµ‹è¯•å¥½ï¼Œå¥½æµ‹è¯•ï¼Œæµ‹å¥½è¯•ã€‚æœ¬æ–‡æ•´ç†ä¸€äº›æµ‹è¯•ç­–ç•¥å’Œæœ€ä½³çš„æµ‹è¯•å®è·µï¼Œç”¨äºå›¢é˜Ÿå†…éƒ¨åˆ†äº«å’ŒæŒ‡å¯¼è‡ªå·±çš„æ—¥å¸¸å·¥ä½œã€‚

> å‚è€ƒæ–‡ç« ï¼š [React å•å…ƒæµ‹è¯•ç­–ç•¥åŠè½åœ°](https://insights.thoughtworks.cn/react-strategies-for-unit-testing/)

# æµ‹è¯•çš„ç›®çš„

ä½œä¸ºä¸€ä¸ªç»å†è¿‡å¤šä¸ªæœ‰æµ‹è¯•å’Œæ²¡æµ‹è¯•çš„æŒç»­è¿­ä»£é¡¹ç›®çš„å¼€å‘è€…ï¼Œæˆ‘æƒ³æ¥è°ˆè°ˆæµ‹è¯•çš„æ„ä¹‰ã€‚
ä¸€ä¸ªè¦†ç›–å…¨é¢ä¸”æœ‰æ•ˆçš„æµ‹è¯•å¯ä»¥ï¼š

1. ä¿è¯å½“å‰ä»£ç ç¬¦åˆé¢„æœŸéœ€æ±‚ï¼šBA ä¼šæŠŠä¸šåŠ¡æ‹†åˆ†æˆå¤§é‡çš„ ACï¼Œä¸€ä¸ªä¼˜ç§€çš„ BA å†™å‡ºæ¥çš„ AC åªéœ€è¡¥å……ä¸€äº›è¾¹ç•Œç»†èŠ‚å³å¯ç›´æ¥ç”¨äºç¼–å†™æµ‹è¯•ä»£ç ï¼Œæµ‹è¯•ä»£ç å¯ä»¥ç›´æ¥ååº”ä¸šåŠ¡é€»è¾‘ã€‚
2. æå‡é‡æ„å’Œä¿®æ”¹æ—¶çš„ä¿¡å¿ƒï¼šæ²¡æœ‰æµ‹è¯•çš„é‡æ„æå®¹æ˜“å†™å‡º bugï¼Œå°¤å…¶æ˜¯å½“ä½ é‡æ„å…¶ä»–åŒäº‹æˆ–è€…å¥½å‡ å¹´å‰çš„ä»£ç çš„æ—¶å€™ã€‚
3. é˜²æ­¢ç”©é”…ï¼šå‡º bug çš„æ—¶å€™ï¼Œå¦‚æœ user journey å’Œæµ‹è¯•ç”¨ä¾‹ä¸€è‡´ï¼Œé‚£æˆ‘æœ‰è¶³å¤Ÿçš„è‡ªä¿¡è¯´é—®é¢˜ä¸æ˜¯æˆ‘çš„ã€‚
4. æå‡ç³»ç»Ÿç¨³å®šæ€§ï¼šæ‰€æœ‰çš„ç³»ç»Ÿï¼Œä»æ¶æ„å®Œå°±å¼€å§‹æ…¢æ…¢èµ°å‘è…è´¥ï¼Œæœ‰æµ‹è¯•çš„å°±æ˜¯ä¸€å¨å¥å£®çš„å±ï¼Œå…¨é¢çš„æµ‹è¯•è¦†ç›–èƒ½è®©è¿™å¨å±ä¿æŒå¥å£®çš„å¤–å½¢æ›´ä¹…ä¸€ç‚¹ï¼Œæ²¡æµ‹è¯•çš„ç³»ç»Ÿå¯èƒ½æ—©å°±æ‹‰å®äº†ã€‚

## ä¸ºä½•å‰ç«¯å¼€å‘è€…æ™®éä¸æ„¿æ„å†™æµ‹è¯•ï¼Ÿ

1. å‰ç«¯ä¸šåŠ¡ä»£ç çš„è°ƒæ•´é¢‘ç‡æ™®éæ¯”åç«¯é«˜ï¼šå‰ç«¯æ˜¯å¤¹åœ¨äº§å“ï¼ŒUX å’Œåç«¯ä¹‹é—´çš„äººï¼Œåç«¯éœ€æ±‚é€šå¸¸æ¯”å‰ç«¯ç¨³å®šï¼Œè¿™å°±å¯¼è‡´äº†å¤§éƒ¨åˆ†ä¸šåŠ¡æ”¹åŠ¨ä¼šä¼˜å…ˆè€ƒè™‘è®©å‰ç«¯åšã€‚
2. æµ‹è¯• UI å¾ˆéº»çƒ¦ï¼šå•å…ƒæµ‹è¯•æ˜¯æµ‹è¯•è¾“å…¥å’Œé¢„æœŸï¼Œåç«¯çš„çº¯é€»è¾‘ä»£ç å¾ˆå®¹æ˜“æ‹†åˆ†ä»£ç å’Œæµ‹è¯•ï¼Œä½†æ˜¯å‰ç«¯å¾ˆéš¾ã€‚å‰ç«¯é€»è¾‘ä»£ç å’Œ UI è€¦åˆï¼Œå¯¹äºä¸€äº›çŠ¶æ€å¤æ‚çš„ UIï¼Œå†™æµ‹è¯•ç›¸å½“ç—›è‹¦ã€‚
3. é»‘ç›’æµ‹è¯•åŸºæœ¬å¯ä»¥ä¿è¯å‰ç«¯æµ‹è¯•éœ€æ±‚ï¼šå‰ç«¯çš„é”™è¯¯å¾ˆå®¹æ˜“è¢«å‘ç°å’Œä¿®å¤ï¼Œä»å•†ä¸šä»·å€¼ä¸Šè€ƒè™‘ï¼ŒæŠ•å…¥å’Œäº§å‡ºå¹¶ä¸æˆæ­£æ¯”ã€‚
4. å¤ªè€—æ—¶é—´ï¼šæµ‹è¯•çš„ä»£ç é‡è¿œæ¯”ä¸šåŠ¡ä»£ç å¤šï¼Œå½“ä½ ä¸šåŠ¡éƒ½å†™ä¸å®Œçš„æ—¶å€™ï¼Œæµ‹è¯•å°±å˜æˆäº†è´Ÿæ‹…ã€‚å¤§éƒ¨åˆ†å›½å†…çš„è€æ¿å¹¶ä¸åœ¨æ„æŒç»­è¿­ä»£å’Œé‡æ„çš„ä»·å€¼ï¼ˆé‡æ„å°±æ˜¯ä½ åŸæ¥çš„ä»£ç æ²¡å†™å¥½ï¼Œæ‰£é’±ï¼‰ï¼Œä¸å°‘ç½‘é¡µçš„ç”Ÿå‘½å‘¨æœŸä¸é•¿ï¼Œè¿›ä¸€æ­¥é™ä½äº†æµ‹è¯•çš„æ„ä¹‰ã€‚

æ€»ç»“ä¸‹æ¥å°±æ˜¯æµ‹è¯•å¾ˆæœ‰ç”¨ï¼Œå…³é”®é€»è¾‘å¿…é¡»æœ‰æµ‹è¯•è¦†ç›–ï¼Œä½†æ˜¯æµ‹è¯•è¦†ç›–ç‡è¦è§†å·¥æœŸå’Œé¡¹ç›®æ€§è´¨æ¸è¿›è¦æ±‚ã€‚

# æµ‹è¯•æ¡†æ¶

æµ‹è¯•æ¡†æ¶æ®Šé€”åŒå½’ï¼ŒåŒºåˆ«ä¸å¤§ï¼Œä»¥å½“å‰è¾ƒæµè¡Œçš„æ¡†æ¶ä¸ºä¾‹ï¼š

- å•å…ƒæµ‹è¯•ï¼š `Jest` + `testing-library`ï¼Œ
- e2e æµ‹è¯•ï¼š`cypress`ï¼Œ
- å¯è§†åŒ–ï¼š`storybook`

# æµ‹è¯•é‡‘å­—å¡”

è€ƒè™‘åˆ°æˆæœ¬ä¸æ”¶ç›Šï¼Œæµ‹è¯•é€šå¸¸åˆ†ä¸ºä¸‰å±‚ï¼Œåº”å¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚

ä¸åŒæµ‹è¯•çš„æˆæœ¬å’Œæ•ˆç‡å¦‚å›¾æ‰€ç¤ºã€‚

![æµ‹è¯•é‡‘å­—å¡”](1.png)

- UI å±‚ï¼šé€šå¸¸ç”¨ e2e æµ‹è¯•å’Œé»‘ç›’æµ‹è¯•è¦†ç›–ï¼Œç›®çš„æ˜¯è¦†ç›–å…³é”®çš„ç”¨æˆ·æ“ä½œæµç¨‹ï¼Œä¿è¯æœ€ä½é™åº¦çš„åŠŸèƒ½å¯ç”¨æ€§
- Service å±‚
- Unit å±‚ï¼šå•å…ƒæµ‹è¯•æˆæœ¬æœ€ä½é€Ÿåº¦æœ€å¿«ï¼Œä¸”å¯¹å•å…ƒçš„ä¿æŠ¤ä»·å€¼æ›´å¤§ã€‚åœ¨é‡‘å­—å¡”ä½“ç³»ä¸­ï¼Œä½å±‚çº§çš„å•å…ƒæµ‹è¯•å æ¯”æœ€å¤šã€‚

# E2E æµ‹è¯•

å¯¹äºç«¯åˆ°ç«¯æµ‹è¯•è¿™ä¸€å—æˆ‘çš„äº†è§£ä¹Ÿä¸æ·±å…¥ï¼Œæ¥è§¦æœ€å¤šçš„æ˜¯ `cypress` å’Œ `selenium`ï¼Œå…¶ä¸­`selenium`åˆšå¥½å°±æ˜¯è‡ªå·±æ‰€åœ¨çš„å…¬å¸å¼€å‘çš„æ¡†æ¶ã€‚

`selenium` çš„åŸç†æ˜¯é€šè¿‡ webdriver å°† python æˆ–å…¶ä»–è¯­è¨€å†™çš„è„šæœ¬è½¬åŒ–æˆæŒ‡ä»¤å‘é€ç»™æµè§ˆå™¨é©±åŠ¨ï¼Œç„¶åæ“çºµæµè§ˆå™¨æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œã€‚å› ä¸ºæ˜¯åŸºäºæµè§ˆå™¨åŸç”Ÿ APIï¼Œæ‰€ä»¥å¯ä»¥æ”¯æŒæ‰€æœ‰å…¼å®¹ webdriver çš„æµè§ˆå™¨ã€‚ç”±äºæŠ€æœ¯æˆç†Ÿç¤¾åŒºä¸°å¯Œï¼Œæ‰€ä»¥æ¯”è¾ƒé€‚åˆå›¢é˜Ÿçš„ä¸“ä¸šæµ‹è¯•äººå‘˜ã€‚ä¸è¿‡æˆ‘æ¥è§¦æœ€å¤šçš„`selenium`åº”ç”¨æ˜¯çˆ¬è™« ğŸ˜…ï¼Œè€Œä¸æ˜¯å‰ç«¯æµ‹è¯•ã€‚

`cypress` å°†æµ‹è¯•ä»£ç å’Œ web åº”ç”¨è¿è¡Œåœ¨åŒä¸€åŸŸåä¸‹çš„ä¸åŒ iframe å†…ï¼Œå› æ­¤`cypress`è„šæœ¬å¯ä»¥ç›´æ¥è°ƒç”¨ DOM apiï¼Œé€šè¿‡ node è¿˜å¯ä»¥ä»£ç†è¯·æ±‚ã€‚`cypress`åªæ”¯æŒ js å’Œ chrome æµè§ˆå™¨ï¼Œå¯¹å‰ç«¯å¼€å‘äººå‘˜æ›´å‹å¥½ï¼Œç›¸æ¯”`selenium`ä¹Ÿæ›´å¿«ã€‚

ç”±äºæˆæœ¬é«˜ï¼Œè‡ªåŠ¨åŒ– e2e æµ‹è¯•å…³æ³¨ä¸šåŠ¡èƒœè¿‡å…³æ³¨æŠ€æœ¯ç»†èŠ‚ï¼Œå¸¸ç”¨äºæ ¸å¿ƒä¸šåŠ¡çš„å›å½’æµ‹è¯•ã€‚ä¸€èˆ¬çš„ç»„ä»¶æµ‹è¯•å¤ªä¼šç”¨åˆ°ã€‚

# snapshot

jest æä¾›äº† snapshot å¿«ç…§çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªå¯ä¾›æµ‹è¯•çš„å¿«ç…§ã€‚

å½“æˆ‘ä»¬å†™å®Œç»„ä»¶ï¼Œå¯¹æ¯ä¸€ç§é€»è¾‘åˆ†æ”¯çš„ UI ä¿å­˜ä¸€ä¸ªå¿«ç…§ï¼Œè¿™æ ·å½“ä»£ç å‘ç”Ÿä¿®æ”¹çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å¯¹æ¯”å¿«ç…§æ¥åˆ¤æ–­æµ‹è¯•æ˜¯å¦é€šè¿‡ã€‚

åˆ›å»ºå’Œç»´æŠ¤ snapshot çš„æˆæœ¬å¾ˆä½ï¼Œä½†å®è·µä¸‹æ¥å‘ç° snapshot é¢ä¸´ä¸€äº›é—®é¢˜ï¼š

1. é«˜é£é™©ï¼šå¿«ç…§æµ‹è¯•å¾ˆè„†å¼±ï¼Œä»»ä½•æ›´æ”¹ï¼Œå“ªæ€•å’Œæƒ³æµ‹è¯•çš„åŠŸèƒ½æ²¡æœ‰å…³ç³»ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´å¿«ç…§æµ‹è¯•å¤±è´¥ï¼Œç„¶åéœ€è¦å¼€å‘äººå‘˜è®¤çœŸå¯¹æ¯”å¿«ç…§ï¼Œå¦‚æœæœ‰äººæ¼çœ‹è€Œç›´æ¥æ›´æ–°äº†å¿«ç…§ï¼Œå¾ˆå®¹æ˜“æŠŠé”™è¯¯ç›´æ¥ç•¥è¿‡äº†ã€‚
2. å¯è¯»æ€§å·®ï¼šå¿«ç…§æµ‹è¯•ä»£ç å®é™…ä¸Šå¹¶æ²¡æœ‰è¡¨æ˜ä»»ä½•å…³äºé¢„æœŸè¾“å‡ºçš„ä¿¡æ¯ï¼Œåªæ˜¯è¡¨æ˜å®ƒä¸åº”è¯¥æ”¹å˜ã€‚ä¸å•å…ƒæµ‹è¯•å’ŒåŠŸèƒ½æµ‹è¯•ä¸åŒï¼Œå¿«ç…§æµ‹è¯•ä¸åŒ…å«æœ‰é’ˆå¯¹æ€§çš„ã€æœ‰æ„ä¹‰çš„æ–­è¨€æˆ–æœŸæœ›ã€‚å½“æµ‹è¯•æŒ‚æ‰çš„æ—¶å€™ï¼Œå¼€å‘è€…éœ€è¦å»é˜…è¯»å¿«ç…§ä»£ç ä»¥åˆ†è¾¨å‡ºé—®é¢˜çš„ä»£ç æ˜¯å¦å’Œæˆ‘ä»¬æœŸæœ›çš„è¾“å‡ºæœ‰å…³ï¼Œå¦‚æœè¿™ä¸ªå¼€å‘è€…å¯¹ä»£ç ä¸ç†Ÿæ‚‰ï¼Œé‚£ä»–å¯èƒ½ä¼šé‡åˆ°éº»çƒ¦ã€‚
3. ä¸é€‚åˆåŠ¨æ€å†…å®¹ï¼šè¾“å…¥çš„å†…å®¹å¦‚æœæ˜¯åŠ¨æ€çš„ï¼Œå¿«ç…§é€šå¸¸ä¼šç›´æ¥æŒ‚æ‰ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡`expect.any()`æ¥é¿å…ï¼‰ï¼Œå¯¹äºè¾“å…¥å†…å®¹ä¸å›ºå®šçš„æµ‹è¯•ï¼Œæœ€å¥½è¿˜æ˜¯ä¸è¦ç”¨å¿«ç…§æµ‹è¯•ã€‚
4. å ç”¨ç©ºé—´ï¼šæ»¥ç”¨ snapshot ä¼šæå¤§åœ°å¢åŠ é¡¹ç›®çš„å¤§å°ã€‚

## ä»€ä¹ˆæ—¶å€™ç”¨ snapshotï¼Ÿ

å¦‚ä¸Šé¢æ‰€è¯´ï¼Œä¸ºäº†ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œå•å…ƒæµ‹è¯•/åŠŸèƒ½æµ‹è¯•æ˜¯ä¼˜å…ˆäºå¿«ç…§æµ‹è¯•çš„ï¼Œä½†å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨å¿«ç…§æµ‹è¯•ã€‚

1. ç»„ä»¶ä¸å¸¸æ›´æ–°ï¼šå¦‚æœç»„ä»¶ç»å¸¸æ”¹å˜ï¼Œæ›´æ–°å¿«ç…§æµ‹è¯•çš„æ—¶å€™å¾ˆå®¹æ˜“æ¼æ‰ bug
2. ç»„ä»¶é€»è¾‘ä¸å¤æ‚ï¼šå¦‚æœç»„ä»¶å¤ªå¤æ‚ï¼Œå¼€å‘è€…å¾ˆéš¾ç¡®å®šå¿«ç…§æµ‹è¯•åˆ°åº•æµ‹çš„æ˜¯ä»€ä¹ˆåŠŸèƒ½
3. å¾ˆå®¹æ˜“åœ¨æµè§ˆå™¨çœ‹åˆ°è¦æµ‹è¯•çš„å†…å®¹ï¼šä¾¿äºå½“å¼€å‘è€…ä¸ç¡®å®šå¿«ç…§åˆ°åº•åœ¨æµ‹ä»€ä¹ˆçš„æ—¶å€™å¯ä»¥é€šè¿‡æµè§ˆå™¨å¤ç°

åœ¨ä½¿ç”¨ snapshot çš„æ—¶å€™ä¸€å®šè¦æŠŠæµ‹è¯•åç§°å†™å¥½ï¼Œå› ä¸ºä»¥åçœŸçš„å¾ˆå®¹æ˜“å¿˜æ‰è¿™ä¸ª snapshot åˆ°åº•åœ¨æµ‹ä»€ä¹ˆã€‚

# å•å…ƒæµ‹è¯•

## ä»€ä¹ˆæ˜¯å¥½çš„å•å…ƒæµ‹è¯•

> è¿™ä¸€éƒ¨åˆ†ä¸»è¦å‚è€ƒæ—ä¸›ç¾½çš„åšå®¢ï¼Œæ„Ÿå…´è¶£å»ºè®®è¯»åŸæ–‡

ä¸€ä¸ªæœ€ç®€å•çš„ JavaScript å•å…ƒæµ‹è¯•é•¿ä»€ä¹ˆæ ·:

```js
// production code
const computeTotalAmount = (products) => {
  return products.reduce((total, product) => total + product.price, 0);
};

// testing code
describe('computeTotalAmount', () => {
  it('should return summed up total amount 1000 when there are three products priced 200, 300, 500', () => {
    // given - å‡†å¤‡æ•°æ®
    const products = [
      { name: 'nike', price: 200 },
      { name: 'adidas', price: 300 },
      { name: 'lining', price: 500 },
    ];

    // when - è°ƒç”¨è¢«æµ‹å‡½æ•°
    const result = computeTotalAmount(products);

    // then - æ–­è¨€ç»“æœ
    expect(result).toBe(1000);
  });
});
```
éµå¾ª given-when-then çš„ç»“æ„ã€‚ä¸€ä¸ªé«˜æ•ˆçš„çš„å•å…ƒæµ‹è¯•åº”ç¬¦åˆï¼š

- åªå…³æ³¨è¾“å…¥è¾“å‡ºï¼Œä¸å…³æ³¨å†…éƒ¨å®ç°
- åªæµ‹ä¸€æ¡åˆ†æ”¯
- è¡¨è¾¾åŠ›æå¼º
- ä¸åŒ…å«é€»è¾‘
- è¿è¡Œé€Ÿåº¦å¿«

**åªå…³æ³¨è¾“å…¥è¾“å‡ºï¼Œä¸å…³æ³¨å†…éƒ¨å®ç°**

æ¯”å¦‚ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œæµ‹è¯•æœ¬èº«ä¸å…³æ³¨ä½ æ˜¯å¦‚ä½•å®Œæˆâ€œæ±‚æ€»ä»·æ ¼â€çš„ï¼Œå› æ­¤ä½ å¯ä»¥ç”¨ `reduce` å®ç°ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å†™ `for` å¾ªç¯å®ç°ã€‚**åªè¦æµ‹è¯•è¾“å…¥æ²¡æœ‰å˜ï¼Œè¾“å‡ºå°±ä¸åº”è¯¥å˜**ã€‚

**åªæµ‹ä¸€æ¡åˆ†æ”¯**
åªæµ‹ä¸€æ¡åˆ†æ”¯ï¼Œæ‰èƒ½ç»™æµ‹è¯•ä»£ç å†™ä¸€ä¸ªå¥½çš„æè¿°ï¼Œè¿™ä¸ªæµ‹è¯•æ‰èƒ½ä¿æŠ¤è¿™ä¸ªç‰¹å®šçš„ä¸šåŠ¡åœºæ™¯ï¼ŒæŒ‚äº†çš„æ—¶å€™èƒ½ç»™ä½ ç»†è‡´åˆ°è¾“å…¥è¾“å‡ºçº§åˆ«çš„ä¸šåŠ¡åé¦ˆã€‚

**è¡¨è¾¾åŠ›æå¼º**
è¡¨è¾¾åŠ›å¼ºçš„æµ‹è¯•ï¼Œèƒ½åœ¨å¤±è´¥çš„æ—¶å€™ç»™ä½ éå¸¸è¿…é€Ÿçš„åé¦ˆã€‚å®ƒè®²çš„æ˜¯ä¸¤æ–¹é¢ï¼š

- çœ‹åˆ°æµ‹è¯•æ—¶ï¼Œä½ å°±çŸ¥é“å®ƒæµ‹çš„ä¸šåŠ¡ç‚¹æ˜¯å•¥
- æµ‹è¯•æŒ‚æ‰æ—¶ï¼Œèƒ½æ¸…æ¥šåœ°çŸ¥é“å¤±è´¥çš„ä¸šåŠ¡åœºæ™¯ã€æœŸæœ›æ•°æ®ä¸å®é™…è¾“å‡ºçš„å·®å¼‚

æ€»ç»“èµ·æ¥ï¼Œè¿™äº›è¡¨è¾¾åŠ›ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹çš„æ–¹é¢ï¼š

- **æµ‹è¯•æè¿°**ã€‚éµå¾ªä¸Šä¸€æ¡åŸåˆ™ï¼ˆä¸€ä¸ªå•å…ƒæµ‹è¯•åªæµ‹ä¸€ä¸ªåˆ†æ”¯ï¼‰çš„æƒ…å†µä¸‹ï¼Œæè¿°é€šå¸¸èƒ½å†™å‡ºä¸€ä¸ªç›¸å½“è¯¦ç»†çš„ä¸šåŠ¡åœºæ™¯ã€‚è¿™ä¸ºæµ‹è¯•çš„è¯»è€…æä¾›äº†æä½³çš„ä¸šåŠ¡ä¸Šä¸‹æ–‡
- **æµ‹è¯•æ•°æ®å‡†å¤‡**ã€‚æ— å…³çš„æµ‹è¯•æ•°æ®ï¼ˆæ¯”å¦‚å¯¹è±¡ä¸­çš„å¾ˆå¤šæ— å…³å­—æ®µï¼‰ä¸åº”è¯¥å†™å‡ºæ¥ï¼Œåº”åªå‡†å¤‡èƒ½ä½“ç°æµ‹è¯•ä¸šåŠ¡çš„æœ€å°æ•°æ®
- **è¾“å‡ºæŠ¥å‘Š**ã€‚é€‰ç”¨æ–­è¨€å·¥å…·æ—¶ï¼Œåº”æ³¨æ„é™¤äº†è¦æä¾›æµ‹è¯•ç»“æœï¼Œè¿˜è¦èƒ½å‡†ç¡®æä¾›â€œæœŸæœ›å€¼â€ä¸â€œå®é™…å€¼â€çš„å·®å¼‚

**ä¸åŒ…å«é€»è¾‘**
è·Ÿå†™å£°æ˜å¼çš„ä»£ç ä¸€æ ·çš„é“ç†ï¼Œæµ‹è¯•éœ€è¦éƒ½æ˜¯ç®€å•çš„å£°æ˜ï¼šå‡†å¤‡æ•°æ®ã€è°ƒç”¨å‡½æ•°ã€æ–­è¨€ï¼Œè®©äººä¸€çœ¼å°±æ˜ç™½è¿™ä¸ªæµ‹è¯•åœ¨æµ‹ä»€ä¹ˆã€‚å¦‚æœå«æœ‰é€»è¾‘ï¼Œä½ è¯»çš„æ—¶å€™å°±è¦å¤šèŠ±æ—¶é—´ç†è§£ï¼›ä¸€æ—¦æµ‹è¯•æŒ‚æ‰ï¼Œä½ å’‹çŸ¥é“æ˜¯å®ç°æŒ‚äº†è¿˜æ˜¯æµ‹è¯•æœ¬èº«å°±æŒ‚äº†å‘¢ï¼Ÿ

**è¿è¡Œé€Ÿåº¦å¿«**
å•å…ƒæµ‹è¯•åªæœ‰åœ¨æ¯«ç§’çº§åˆ«å†…å®Œæˆï¼Œå¼€å‘è€…æ‰ä¼šæ„¿æ„é¢‘ç¹åœ°è¿è¡Œå®ƒï¼Œå°†å…¶ä½œä¸ºå¿«é€Ÿåé¦ˆçš„æ‰‹æ®µä¹Ÿæ‰èƒ½æˆç«‹ã€‚é‚£ä¹ˆä¸ºäº†ä½¿å•å…ƒæµ‹è¯•æ›´å¿«ï¼Œæˆ‘ä»¬éœ€è¦ï¼š

- å°½å¯èƒ½åœ°é¿å…ä¾èµ–ã€‚é™¤äº†æ°å½“è®¾è®¡å¥½å¯¹è±¡ï¼Œå…³äºé¿å…ä¾èµ–æˆ‘å·²çŸ¥æœ‰ä¸¤ç§ä¸åŒçš„çœ‹æ³•ï¼š
    1. ä½¿ç”¨ mock é€‚å½“éš”ç¦»æ‰ä¸‰æ–¹çš„ä¾èµ–ï¼ˆå¦‚æ•°æ®åº“ã€ç½‘ç»œã€æ–‡ä»¶ç­‰ï¼‰
    2. é¿å… mockï¼Œæ¢ç”¨æ›´å¿«é€Ÿçš„æ•°æ®åº“ã€å¯åŠ¨è½»é‡çº§æœåŠ¡å™¨ã€é‡ç‚¹æµ‹è¯•æ–‡ä»¶å†…å®¹ç­‰æ¥è¿‚å›
- å°†ä¾èµ–ã€é›†æˆç­‰è€—æ—¶ã€ä¾èµ–ä¸‰æ–¹è¿”å›çš„åœ°æ–¹æ”¾åˆ°æ›´é«˜å±‚çº§çš„æµ‹è¯•ä¸­ï¼Œæœ‰ç­–ç•¥æ€§åœ°å»åš

## React å•å…ƒæµ‹è¯•ç­–ç•¥

ä»¥å¸¸è§çš„ react + redux æ¶æ„ä¸ºä¾‹ï¼ŒåŒç†å¯ä»¥è¡ç”Ÿåˆ°ä»»ä½•ç”¨äº†reduxæ€æƒ³çš„æ¶æ„ï¼ˆrematchï¼Œdvaï¼Œcontextï¼Œswrï¼Œetcï¼‰ã€‚

é€šå¸¸å®˜ç½‘éƒ½ä¼šæœ‰æµ‹è¯•å¼•å¯¼ï¼Œæ‰€ä»¥ä¸åšè¯¦ç»†æ¼”ç¤ºã€‚

| æ¶æ„å±‚çº§          | æµ‹è¯•å†…å®¹                                               | æµ‹è¯•ç­–ç•¥                          | è§£é‡Š                                                         |
| ----------------- | ------------------------------------------------------ | --------------------------------- | ------------------------------------------------------------ |
| action(creator)å±‚ | æ˜¯å¦æ­£ç¡®åˆ›å»º action å¯¹è±¡                               | ä¸€èˆ¬ä¸éœ€è¦æµ‹è¯•ï¼Œè§†ä¿¡å¿ƒè€Œå®š        | è¿™ä¸ªå±‚çº§æ¶æ„ä¸Šéå¸¸ç®€å•ï¼Œè®¾æ–½æ­å¥½ä»¥åä¸€èˆ¬ä¸å¯èƒ½å‡ºé”™           |
| reducer å±‚        | æ˜¯å¦æ­£ç¡®å®Œæˆè®¡ç®—                                       | æœ‰é€»è¾‘çš„ reducer è¦æ±‚ 100%è¦†ç›–ç‡  | è¿™ä¸ªå±‚çº§è¾“å…¥è¾“å‡ºæ˜ç¡®ï¼ŒåˆåŒ…å«ä¸šåŠ¡è®¡ç®—ï¼Œéå¸¸é€‚åˆå•å…ƒæµ‹è¯•       |
| selector å±‚       | æ˜¯å¦æ­£ç¡®å®Œæˆè®¡ç®—                                       | æœ‰é€»è¾‘çš„ selector è¦æ±‚ 100%è¦†ç›–ç‡ | è¿™ä¸ªå±‚çº§è¾“å…¥è¾“å‡ºæ˜ç¡®ï¼ŒåˆåŒ…å«ä¸šåŠ¡è®¡ç®—ï¼Œéå¸¸é€‚åˆå•å…ƒæµ‹è¯•       |
| saga å±‚           | æ˜¯å¦è·å–äº†æ­£ç¡®çš„å‚æ•°                                   | è¿™äº”ä¸ªä¸šåŠ¡ç‚¹å»ºè®® 100% è¦†ç›–        | è¿™ä¸ªå±‚çº§ä¸»è¦åŒ…å«å‰è¿° 5 å¤§æ–¹é¢çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿›è¡Œæµ‹è¯•å¾ˆæœ‰é‡æ„ä»·å€¼ |
|                   | æ˜¯å¦æ­£ç¡®åœ°è°ƒç”¨äº† API                                   |                                   |                                                              |
|                   | æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„è¿”å›å€¼å­˜å–å› redux ä¸­                  |                                   |                                                              |
|                   | ä¸šåŠ¡åˆ†æ”¯é€»è¾‘                                           |                                   |                                                              |
|                   | å¼‚å¸¸é€»è¾‘                                               |                                   |                                                              |
| component å±‚      | ç»„ä»¶åˆ†æ”¯æ¸²æŸ“é€»è¾‘                                       | è¦æ±‚ 100%è¦†ç›–                     | è¿™ä¸ªå±‚çº§æœ€ä¸ºå¤æ‚ï¼Œè¿˜æ˜¯ä»¥ã€Œä»£ä»·æœ€ä½ï¼Œæ”¶ç›Šæœ€é«˜ã€ä¸ºæŒ‡å¯¼åŸåˆ™è¿›è¡Œ |
|                   | äº¤äº’äº‹ä»¶æ˜¯å¦ä»¥æ­£ç¡®çš„å‚æ•°è¢«è°ƒç”¨                         | è¦æ±‚ 100%è¦†ç›–                     |                                                              |
|                   | redux connect è¿‡çš„ç»„ä»¶ï¼ˆæˆ–è€…æœ‰context providerçš„ç»„ä»¶ï¼‰ | ä¸æµ‹                              |                                                              |
| UI å±‚             | ç»„ä»¶æ˜¯å¦æ¸²æŸ“äº†æ­£ç¡®çš„æ ·å¼                               | ç›®å‰ä¸æµ‹                          | æµ‹è¯•è¾ƒéš¾ç¨³å®šï¼Œæˆæœ¬åˆè¾ƒé«˜                                     |
| utils å±‚          | å„ç§å¸®åŠ©å‡½æ•°                                           | æ²¡æœ‰å‰¯ä½œç”¨çš„å¿…é¡» 100% è¦†ç›–        |                                                              |

# React å•å…ƒæµ‹è¯•è½åœ°

## å‰¯ä½œç”¨ saga / thunk

å¯¹äº”ä¸ªä¸šåŠ¡ç‚¹è¿›è¡Œæµ‹è¯•ï¼Œéœ€è¦mockæ‰å®é™…APIè¯·æ±‚ã€‚

ä¸»è¦è§‚å¯Ÿ

- æ˜¯å¦ä½¿ç”¨æ­£ç¡®çš„å‚æ•°ï¼ˆé€šå¸¸æ˜¯ä» action payload æˆ– redux ä¸­æ¥ï¼‰ï¼Œè°ƒç”¨äº†æ­£ç¡®çš„ API
- å¯¹äº mock çš„ API è¿”å›ï¼Œæ˜¯å¦ä¿å­˜äº†æ­£ç¡®çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯é€šè¿‡ action ä¿å­˜åˆ° redux ä¸­å»ï¼‰
- ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘ï¼ˆæ¯”å¦‚ä»…å½“ç”¨æˆ·æ»¡è¶³æŸäº›æƒé™æ—¶æ‰è°ƒç”¨ API ç­‰åˆ†æ”¯é€»è¾‘ï¼‰
- å¼‚å¸¸é€»è¾‘ï¼ˆæ¯”å¦‚æ‰¾ä¸åˆ°ç”¨æˆ·ç­‰å¼‚å¸¸é€»è¾‘ï¼‰
- å…¶ä»–å‰¯ä½œç”¨æ˜¯å¦å‘ç”Ÿï¼ˆæ¯”å¦‚æœ‰æ—¶æœ‰éœ€è¦ Emit çš„äº‹ä»¶ã€éœ€è¦ä¿å­˜åˆ° IndexDB ä¸­å»çš„æ•°æ®ç­‰ï¼‰

## ç»„ä»¶æµ‹è¯•

ç»„ä»¶æµ‹è¯•å…¶å®æ˜¯å®è·µæœ€å¤šã€æµ‹è¯•å®è·µçœ‹æ³•å’Œåˆ†æ­§ä¹Ÿæœ€å¤šçš„åœ°æ–¹ã€‚React ç»„ä»¶æ˜¯ä¸€ä¸ªé«˜åº¦è‡ªæ²»çš„å•å…ƒï¼Œä»åˆ†ç±»ä¸Šæ¥çœ‹ï¼Œå®ƒå¤§æ¦‚æœ‰è¿™ä¹ˆå‡ ç±»ï¼š

- å±•ç¤ºå‹ä¸šåŠ¡ç»„ä»¶
- å®¹å™¨å‹ä¸šåŠ¡ç»„ä»¶
- é€šç”¨ UI ç»„ä»¶
- åŠŸèƒ½å‹ç»„ä»¶

å…ˆæŠŠè¿™ä¸ªåˆ†ç±»æ”¾åœ¨è¿™é‡Œï¼Œå¾…ä¼šå›è¿‡å¤´æ¥è°ˆã€‚å¯¹äº React ç»„ä»¶æµ‹ä»€ä¹ˆä¸æµ‹ä»€ä¹ˆï¼Œæˆ‘æœ‰ä¸€äº›æ€è€ƒï¼Œä¹Ÿæœ‰ä¸€äº›åˆ¤æ–­æ ‡å‡†ï¼šé™¤å»åŠŸèƒ½å‹ç»„ä»¶ï¼Œå…¶ä»–ç±»å‹çš„ç»„ä»¶ä¸€èˆ¬æ˜¯ä»¥æ¸²æŸ“å‡ºä¸€ä¸ªè¯­æ³•æ ‘ä¸ºç»ˆç‚¹çš„ï¼Œå®ƒæè¿°äº†é¡µé¢çš„ UI å†…å®¹ã€ç»“æ„ã€æ ·å¼å’Œä¸€äº›é€»è¾‘ `component(props) => UI`ã€‚å†…å®¹ã€ç»“æ„å’Œæ ·å¼ï¼Œæ¯”èµ·æµ‹è¯•ï¼Œç›´æ¥åœ¨é¡µé¢ä¸Šè°ƒè¯•åé¦ˆæ•ˆæœæ›´å¥½ã€‚æµ‹ä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œä½†éƒ½éš¾å…æœ‰ä¸ç¨³å®šçš„æˆæœ¬åœ¨ï¼›é€»è¾‘è¿™å—ï¼Œæœ‰ä¸€æµ‹çš„ä»·å€¼ï¼Œä½†éœ€è¦æ§åˆ¶å¥½ä¾èµ–ã€‚ç»¼åˆä¸Šé¢æåˆ°çš„æµ‹è¯•åŸåˆ™è¿›è¡Œè€ƒè™‘ï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼šä¸¤æµ‹ä¸¤ä¸æµ‹ã€‚

- ç»„ä»¶åˆ†æ”¯æ¸²æŸ“é€»è¾‘å¿…é¡»æµ‹
- äº‹ä»¶è°ƒç”¨å’Œå‚æ•°ä¼ é€’ä¸€èˆ¬è¦æµ‹
- è¿æ¥ redux çš„é«˜é˜¶ç»„ä»¶ï¼ˆæˆ–contextçš„provideré«˜é˜¶ç»„ä»¶ï¼‰ä¸æµ‹
- æ¸²æŸ“å‡ºæ¥çš„ UI ä¸åœ¨å•å…ƒæµ‹è¯•å±‚çº§æµ‹

ç»„ä»¶çš„åˆ†æ”¯é€»è¾‘ï¼Œå¾€å¾€ä¹Ÿæ˜¯æœ‰ä¸šåŠ¡å«ä¹‰å’Œä¸šåŠ¡ä»·å€¼çš„åˆ†æ”¯ï¼Œæ·»åŠ å•å…ƒæµ‹è¯•æ—¢èƒ½ä¿éšœé‡æ„ï¼Œè¿˜å¯é¡ºä¾¿åšæ–‡æ¡£ç”¨ï¼›äº‹ä»¶è°ƒç”¨åŒæ ·ä¹Ÿæœ‰ä¸šåŠ¡ä»·å€¼å’Œæ–‡æ¡£ä½œç”¨ï¼Œè€Œäº‹ä»¶è°ƒç”¨çš„å‚æ•°è°ƒç”¨æœ‰æ—¶å¯èµ·åˆ°ä¿æŠ¤é‡æ„çš„ä½œç”¨ã€‚

çº¯ UI ä¸åœ¨å•å…ƒæµ‹è¯•çº§åˆ«æµ‹è¯•çš„åŸå› ï¼Œå› ä¸ºä¸å¥½æ–­è¨€ã€‚

ç„¶åï¼ŒåŸºäºä¸Šé¢ç¬¬ 1ã€2 ä¸ªç»“è®ºï¼Œæ˜ å°„å›å››ç±»ç»„ä»¶çš„ç»“æ„å½“ä¸­å»ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢çš„è¡¨æ ¼ï¼Œç„¶åå‘ç°â€¦æ¯ç§ç»„ä»¶éƒ½è¦æµ‹**æ¸²æŸ“åˆ†æ”¯**å’Œ**äº‹ä»¶è°ƒç”¨**ï¼Œè·Ÿç»„ä»¶ç±»å‹æ ¹æœ¬æ²¡å¿…ç„¶çš„å…³è”â€¦ä¸è¿‡ï¼ŒåŠŸèƒ½å‹ç»„ä»¶æœ‰å¯èƒ½ä¼šæ¶‰åŠä¸€äº›å…¶ä»–çš„æ¨¡å¼ï¼Œå› æ­¤åˆå¤§è‡´åˆ†å‡ºä¸€å°èŠ‚æ¥è°ˆã€‚

| ç»„ä»¶ç±»å‹ / æµ‹è¯•å†…å®¹ | åˆ†æ”¯æ¸²æŸ“é€»è¾‘ | äº‹ä»¶è°ƒç”¨ | çº¯ UI |
| :------------------ | :----------- | :------- | :---- |
| å±•ç¤ºå‹ç»„ä»¶          | âœ…            | âœ…        | âœ–ï¸     |
| å®¹å™¨å‹ç»„ä»¶          | âœ…            | âœ…        | âœ–ï¸     |
| é€šç”¨ UI ç»„ä»¶        | âœ…            | âœ…        | âœ–ï¸     |
| åŠŸèƒ½å‹ç»„ä»¶          | âœ…            | âœ…        | âœ–ï¸     |

### ä¸šåŠ¡å‹ç»„ä»¶ - åˆ†æ”¯æ¸²æŸ“

```jsx
export const CommentsSection = ({ comments }) => (
  <div>
    {comments.length > 0 && (
      <h2>Comments</h2>
    )}

    {comments.map((comment) => (
      <Comment content={comment} key={comment.id} />
    )}
  </div>
)
```

å¯¹åº”çš„æµ‹è¯•å¦‚ä¸‹ï¼Œæµ‹è¯•çš„æ˜¯ä¸åŒçš„åˆ†æ”¯æ¸²æŸ“é€»è¾‘ï¼šæ²¡æœ‰è¯„è®ºæ—¶ï¼Œåˆ™ä¸æ¸²æŸ“ Comments headerã€‚

```jsx
import { render, screen } from '@testing-library/react'
import { CommentsSection } from './index'
import { Comment } from './Comment'

jest.mock('./Comment', () => ({
  Comment: () => <div>Comment</div>
}));
test('should not render a header and any comment sections when there is no comments', () => {
  render(<CommentsSection comments={[]} />)

  const header = screen.queryByRole('h2')
  const comments = screen.queryByText("Comment")

  expect(header).not.toBeInTheDocument()
  expect(comments).not.toBeInTheDocument()
})

test('should render a comments section and a header when there are comments', () => {
  const contents = [
    { id: 1, author: 'ç”·***8', comment: 'ä»·å»‰ç‰©ç¾ï¼Œç›¸ä¿¡å¥¥åº·æ——èˆ°åº—' },
    { id: 2, author: 'é›¨***æˆ', comment: 'æ‰€ä»¥ä¸€åŒåˆè„šçš„é‹å­...' },
  ]
 render(<CommentsSection comments={contents} />)

  const header = screen.queryByRole('h2')
  const comments = screen.queryByText("Comment")

  expect(header).toBeInTheDocument()
  expect(comments).toBeInTheDocument()
})
```

### ä¸šåŠ¡å‹ç»„ä»¶ - äº‹ä»¶è°ƒç”¨

æµ‹è¯•äº‹ä»¶çš„ä¸€ä¸ªåœºæ™¯å¦‚ä¸‹ï¼šå½“æŸæ¡äº§å“è¢«ç‚¹å‡»æ—¶ï¼Œåº”è¯¥å°†äº§å“ç›¸å…³çš„ä¿¡æ¯å‘é€ç»™åŸ‹ç‚¹ç³»ç»Ÿè¿›è¡ŒåŸ‹ç‚¹ã€‚

```jsx
export const ProductItem = ({
  id,
  productName,
  introduction,
  trackPressEvent,
}) => (
  <TouchableWithoutFeedback data-testid="touchable-without-feedback" onPress={() => trackPressEvent(id, productName)}>
    <View>
      <Title name={productName} />
      <Introduction introduction={introduction} />
    </View>
  </TouchableWithoutFeedback>
)

import { render, screen, fireEvent } from '@testing-library/react'

test(`
  should send product id and name to analytics system 
  when user press the product item
`, () => {
  const trackPressEvent = jest.fn()
  render(
    <Productitem id={100832}
      introduction="iMac Pro - Power to the pro."
      trackPressEvent={trackPressEvent}></productitem>
  )

  const touchableWithoutFeedback = screen.findByTestId("touchable-without-feedback")
	fireEvent.click(touchableWithoutFeedback);
  
  expect(trackPressEvent).toHaveBeenCalledWith(
    100832,
    'iMac Pro - Power to the pro.'
  )
})
```

ç®€å•å¾—å¾ˆå§ã€‚è¿™é‡Œçš„å‡ ä¸ªæµ‹è¯•ï¼Œåœ¨ä½ æ”¹åŠ¨äº†æ ·å¼ç›¸å…³çš„ä¸œè¥¿æ—¶ï¼Œä¸ä¼šæŒ‚æ‰ï¼›ä½†æ˜¯å¦‚æœä½ æ”¹åŠ¨äº†åˆ†æ”¯é€»è¾‘æˆ–å‡½æ•°è°ƒç”¨çš„å†…å®¹æ—¶ï¼Œå®ƒå°±ä¼šæŒ‚æ‰äº†ã€‚è€Œåˆ†æ”¯é€»è¾‘æˆ–å‡½æ•°è°ƒç”¨ï¼Œæ°å¥½æ˜¯æˆ‘è§‰å¾—æ¥è¿‘ä¸šåŠ¡çš„åœ°æ–¹ï¼Œæ‰€ä»¥å®ƒä»¬å¯¹ä¿æŠ¤ä»£ç é€»è¾‘ã€ä¿æŠ¤é‡æ„æ˜¯æœ‰ä»·å€¼çš„ã€‚å½“ç„¶ï¼Œå®ƒä»¬å¤šå°‘è¿˜æ˜¯ä¾èµ–äº†ç»„ä»¶å†…éƒ¨çš„å®ç°ç»†èŠ‚ï¼Œæ¯”å¦‚è¯´ `find(TouchableWithoutFeedback)`ï¼Œè¿˜æ˜¯åšäº†â€œç»„ä»¶å†…éƒ¨ä½¿ç”¨äº† `TouchableWithoutFeedback` ç»„ä»¶â€è¿™æ ·çš„å‡è®¾ï¼Œè€Œè¿™ä¸ªå‡è®¾å¾ˆå¯èƒ½æ˜¯ä¼šå˜çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘æ¢äº†ä¸€ä¸ªç»„ä»¶æ¥æ¥å—ç‚¹å‡»äº‹ä»¶ï¼Œå°½ç®¡ç‚¹å‡»æ—¶çš„è¡Œä¸ºä¾ç„¶å‘ç”Ÿï¼Œä½†è¿™ä¸ªæµ‹è¯•ä»ç„¶ä¼šæŒ‚æ‰ã€‚è¿™å°±è¿åäº†æˆ‘ä»¬æ‰€è¯´äº†â€œä¸å…³æ³¨å†…éƒ¨å®ç°â€åŸåˆ™ï¼Œè¿™å¯¹äºç»„ä»¶æµ‹è¯•æ¥è¯´ï¼Œç¡®å®æ˜¯ä¸å¤Ÿå®Œç¾çš„åœ°æ–¹ã€‚

ä½†è¿™ä¸ªé—®é¢˜æ— æ³•é¿å…ã€‚å› ä¸ºç»„ä»¶æœ¬è´¨æ˜¯æ¸²æŸ“ç»„ä»¶æ ‘ï¼Œé‚£ä¹ˆæµ‹è¯•ä¸­è¦ä¸ç»„ä»¶æ ‘å…³è”ï¼Œå¿…ç„¶è¦é€šè¿‡ç»„ä»¶åã€idè¿™æ ·çš„ selectorï¼Œè¿™äº› selector çš„å…³è”æœ¬èº«å°±æ˜¯ä¸€äº›â€œå†…éƒ¨å®ç°â€çš„ç»†èŠ‚ã€‚ä½†å¯¹ç»„ä»¶çš„åˆ†æ”¯ã€äº‹ä»¶è¿›è¡Œæµ‹è¯•åˆæœ‰ä¸€å®šçš„ä»·å€¼ï¼Œæ— æ³•é¿å…ã€‚æ‰€ä»¥ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªéƒ¨åˆ†è¿˜æ˜¯è¦ç”¨ï¼Œåªä¸è¿‡åŒæ—¶éœ€è¦ä¸€äº›é™åˆ¶ï¼Œä»¥æ§åˆ¶è¿™äº›å‡è®¾ä¸ºç»´æŠ¤æµ‹è¯•å¸¦æ¥çš„é¢å¤–æˆæœ¬ï¼š

- ä¸è¦æ–­è¨€ç»„ä»¶å†…éƒ¨ç»“æ„ã€‚åƒé‚£äº› `expect(component.find('div > div > p').html().toBe('Content')` çš„çœŸçš„å°±ç®—äº†å§
- æ­£ç¡®æ‹†åˆ†ç»„ä»¶æ ‘ã€‚ä¸€ä¸ªç»„ä»¶å°½é‡åªè´Ÿè´£ä¸€ä¸ªï¼ˆæˆ–ä¸€ç»„é«˜åº¦ç›¸å…³çš„ï¼‰åŠŸèƒ½ï¼Œä¸å…è®¸å †å å¤ªå¤šçš„å‡½æ•°å’ŒåŠŸèƒ½

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ å‘ç°ä½ å¾ˆéš¾å¿«é€Ÿåœ°å‡†å¤‡å¯¹ç»„ä»¶çš„æµ‹è¯•ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½æ˜¯ä½ çš„ç»„ä»¶å¤ªå¤æ‚äº†ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªåå‘³é“ã€‚å¤šæ•°æƒ…å†µä¸‹æ˜¯ç»„ä»¶æ‰¿æ‹…äº†å¤ªå¤šçš„èŒè´£ï¼Œä½ åº”è¯¥å°†å®ƒä»¬æ‹†æˆæ›´å°çš„ç»„ä»¶ï¼Œä½¿å…¶ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚

å¦‚æœä½ çš„æ¯ä¸ªç»„ä»¶éƒ½ååˆ†æ¸…æ™°ç›´è§‚ã€é€»è¾‘åˆ†æ˜ï¼Œé‚£ä¹ˆåƒä¸Šé¢è¿™æ ·çš„ç»„ä»¶æµ‹èµ·æ¥ä¹Ÿå°±å¾ˆè½»æ¾ï¼Œä¸€èˆ¬å°±éµå¾ª `shallow` -> `find(Component)` -> æ–­è¨€çš„ä¸‰æ®µå¼ï¼Œå“ªæ€•æ˜¯äº†è§£äº†ä¸€äº›ç»„ä»¶çš„å†…éƒ¨ç»†èŠ‚ï¼Œé€šå¸¸ä¹Ÿåœ¨å¯æ§çš„èŒƒå›´å†…ï¼Œç»´æŠ¤èµ·æ¥æˆæœ¬å¹¶ä¸é«˜ã€‚è¿™æ˜¯ç›®å‰æˆ‘è§‰å¾—å¹³è¡¡äº†è¡¨è¾¾åŠ›ã€é‡æ„æ„ä¹‰å’Œæµ‹è¯•æˆæœ¬çš„å®è·µã€‚

### åŠŸèƒ½å‹ç»„ä»¶ - `children` å‹é«˜é˜¶ç»„ä»¶

åŠŸèƒ½å‹ç»„ä»¶ï¼ŒæŒ‡çš„æ˜¯è·Ÿä¸šåŠ¡æ— å…³çš„å¦ä¸€ç±»ç»„ä»¶ï¼šå®ƒæ˜¯åŠŸèƒ½å‹çš„ï¼Œæ›´åƒæ˜¯åº•å±‚æ”¯æ’‘ç€ä¸šåŠ¡ç»„ä»¶è¿ä½œçš„åŸºç¡€ç»„ä»¶ï¼Œæ¯”å¦‚è·¯ç”±ç»„ä»¶ã€åˆ†é¡µç»„ä»¶ç­‰ã€‚è¿™äº›ç»„ä»¶ä¸€èˆ¬åé‡é€»è¾‘å¤šä¸€ç‚¹ï¼Œå…³å¿ƒ UI å°‘ä¸€äº›ã€‚å…¶æœ¬è´¨æµ‹æ³•è·Ÿä¸šåŠ¡ç»„ä»¶æ˜¯ä¸€è‡´çš„ï¼šä¸å…³å¿ƒ UI å…·ä½“æ¸²æŸ“ï¼Œåªæµ‹åˆ†æ”¯æ¸²æŸ“å’Œäº‹ä»¶è°ƒç”¨ã€‚ä½†ç”±äºå®ƒååŠŸèƒ½å‹çš„ç‰¹æ€§ï¼Œä½¿å¾—å®ƒåœ¨è®¾è®¡ä¸Šå¸¸ä¼šå‡ºç°ä¸€äº›ä¸šåŠ¡å‹ç»„ä»¶ä¸å¸¸å‡ºç°çš„è®¾è®¡æ¨¡å¼ï¼Œå¦‚é«˜é˜¶ç»„ä»¶ã€ä»¥å‡½æ•°ä¸ºå­ç»„ä»¶ç­‰ã€‚ä¸‹é¢åˆ†åˆ«é’ˆå¯¹è¿™å‡ ç§è¿›è¡Œåˆ†è¿°ã€‚

```jsx
export const FeatureToggle = ({ features, featureName, children }) => {
  if (!features[featureName]) {
    return null
  }

  return children
}

export default FeatureToggle

import React from 'react'
import { render, screen } from '@testing-library/react';
import { View } from 'react-native'

import { FeatureToggle } from './index'

const DummyComponent = () => () => <div>DummyComponent</div>

test('should not render children component when remote toggle does not exist', () => {
 render(
    <FeatureToggle features={{}} featureName="promotion618">
      <DummyComponent />
    </FeatureToggle>
  )
	const dummyComponent = screen.queryByText("DummyComponent")
  expect(dummyComponent).not.toBeInTheDocument()
})

test('should render children component when remote toggle is present and is on', () => {
  const features = {
    promotion618: FeatureToggles.on,
  }

  render(
    <FeatureToggle features={features} featureName="promotion618">
      <DummyComponent />
    </FeatureToggle>
  )

  const dummyComponent = screen.queryByText("DummyComponent")
  expect(dummyComponent).toBeInTheDocument()
})

test('should not render children component when remote toggle is present but is off', () => {
  const features = {
    promotion618: FeatureToggles.off,
  }

  render(
    <FeatureToggle features={features} featureName="promotion618">
      <DummyComponent />
    </FeatureToggle>
  )

  const dummyComponent = screen.queryByText("DummyComponent")
  expect(dummyComponent).not.toBeInTheDocument()
})
```

## çº¯å‡½æ•° utils / reducer / selector æµ‹è¯•

æ¯ä¸ªé¡¹ç›®éƒ½ä¼šæœ‰ utilsã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æœŸæœ› util éƒ½æ˜¯çº¯å‡½æ•°ï¼Œå³æ˜¯ä¸ä¾èµ–å¤–éƒ¨çŠ¶æ€ã€ä¸æ”¹å˜å‚æ•°å€¼ã€ä¸ç»´æŠ¤å†…éƒ¨çŠ¶æ€çš„å‡½æ•°ã€‚è¿™æ ·çš„å‡½æ•°æµ‹è¯•æ•ˆç‡ä¹Ÿéå¸¸é«˜ã€‚æµ‹è¯•åŸåˆ™è·Ÿå‰é¢æ‰€è¯´çš„ä¹Ÿå¹¶æ²¡ä»€ä¹ˆä¸åŒï¼Œä¸å†èµ˜è¿°ã€‚ä¸è¿‡å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå› ä¸º util å‡½æ•°å¤šæ˜¯æ•°æ®é©±åŠ¨ï¼Œä¸€ä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡ºï¼Œå¹¶ä¸”ä¸éœ€è¦å‡†å¤‡ä»»ä½•ä¾èµ–ï¼Œè¿™ä½¿å¾—å®ƒå¤šäº†ä¸€ç§æµ‹è¯•çš„é€‰æ‹©ï¼Œä¹Ÿå³æ˜¯å‚æ•°åŒ–æµ‹è¯•çš„æ–¹å¼ã€‚å‚æ•°åŒ–æµ‹è¯•å¯ä»¥æå‡æ•°æ®å‡†å¤‡æ•ˆç‡ï¼ŒåŒæ—¶ä¾ç„¶èƒ½ä¿æŒè¯¦ç»†çš„ç”¨ä¾‹ä¿¡æ¯ã€é”™è¯¯æç¤ºç­‰ä¼˜ç‚¹ã€‚jest ä» 23 åå°±å†…ç½®äº†å¯¹å‚æ•°åŒ–æµ‹è¯•çš„æ”¯æŒï¼Œå¦‚ä¸‹ï¼š

```javascript
test.each([
  [['0', '99'], 0.99, '(æ•´æ•°éƒ¨åˆ†ä¸º0æ—¶ä¹Ÿåº”è¿”å›)'],
  [['5', '00'], 5, '(å°æ•°éƒ¨åˆ†ä¸è¶³æ—¶åº”è¯¥è¡¥0)'],
  [['5', '10'], 5.1, '(å°æ•°éƒ¨åˆ†ä¸è¶³æ—¶åº”è¯¥è¡¥0)'],
  [['4', '38'], 4.38, '(å°æ•°éƒ¨åˆ†ä¸è¶³æ—¶åº”è¯¥è¡¥0)'],
  [['4', '99'], 4.994, '(è¶…è¿‡é»˜è®¤2ä½çš„å°æ•°çš„ç›´æ¥æˆªæ–­ï¼Œä¸å››èˆäº”å…¥)'],
  [['4', '99'], 4.995, '(è¶…è¿‡é»˜è®¤2ä½çš„å°æ•°çš„ç›´æ¥æˆªæ–­ï¼Œä¸å››èˆäº”å…¥)'],
  [['4', '99'], 4.996, '(è¶…è¿‡é»˜è®¤2ä½çš„å°æ•°çš„ç›´æ¥æˆªæ–­ï¼Œä¸å››èˆäº”å…¥)'],
  [['-0', '50'], -0.5, '(æ•´æ•°éƒ¨åˆ†ä¸ºè´Ÿæ•°æ—¶åº”è¯¥ä¿ç•™è´Ÿå·)'],
])(
  'should return %s when number is %s (%s)',
  (expected, input, description) => {
    expect(truncateAndPadTrailingZeros(input)).toEqual(expected)
  }
)
```

[![img](https://insights.thoughtworks.cn/wp-content/uploads/2019/07/8.png)](https://insights.thoughtworks.cn/wp-content/uploads/2019/07/8.png)

å½“ç„¶ï¼Œå¯¹çº¯æ•°æ®é©±åŠ¨çš„æµ‹è¯•ï¼Œä¹Ÿæœ‰ä¸€äº›ä¸åŒçš„çœ‹æ³•ï¼Œè®¤ä¸ºè¿™æ ·å¯èƒ½ä¸¢å¤±ä¸€äº›æè¿°ä¸šåŠ¡åœºæ™¯çš„æµ‹è¯•æè¿°ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼è¿˜ä¸»è¦çœ‹é¡¹ç›®ç»„çš„æ¥å—åº¦ã€‚

## Jestå®˜æ–¹æ¨¡æ‹Ÿç¤ºèŒƒä»£ç 

åŒ…æ‹¬`å¼‚æ­¥æµ‹è¯•`ï¼Œ`è®¡æ—¶å™¨`å’Œ `mockæ¨¡å—`ç­‰

å»ºè®®ç›´æ¥æŒ‰ç…§å®˜ç½‘çš„ä¾‹å­å†™ [Jest doc](https://jestjs.io/zh-Hans/docs/tutorial-async)

## test-libraryå®è·µ

### é€‰æ‹©åˆé€‚çš„æŸ¥è¯¢è¯­å¥

ä»¥æœ€æ¥è¿‘ç”¨æˆ·çš„æ–¹å¼æŸ¥è¯¢

```jsx
// bad
// assuming you've got this DOM to work with:
// <label>Username</label><input data-testid="username" />
screen.getByTestId('username');

// good
// change the DOM to be accessible by associating the label and setting the type
// <label for="username">Username</label><input id="username" type="text" />
screen.getByRole('textbox', { name: /username/i });

// bad
const { container } = render(<Example />);
const button = container.querySelector('.btn-primary');
expect(button).toHaveTextContent(/click me/i);

// good
render(<Example />);
screen.getByRole('button', { name: /click me/i });

// bad
screen.getByTestId('submit-button');

// good
screen.getByRole('button', { name: /submit/i });
```

### æŸ¥è¯¢ä¼˜å…ˆçº§

#### 1. Queries Accessible to Everyoneï¼ˆæ¯ä¸ªäººéƒ½å¯ä»¥è®¿é—®çš„æŸ¥è¯¢ï¼‰

- `getByRole`

å®ƒå¯ä»¥ç”¨äºæŸ¥è¯¢å¤„äº `accessibility tree` ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ `name` é€‰é¡¹è¿‡æ»¤è¿”å›çš„å…ƒç´ ã€‚

å®ƒåº”è¯¥æ˜¯æˆ‘ä»¬æŸ¥è¯¢çš„é¦–é€‰é¡¹ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒéƒ½ä¼šå¸¦ç€ name é€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œå°±åƒè¿™æ ·ï¼š`getByRole('button', {name: /submit/i})`ã€‚è¿™é‡Œæ˜¯ Roles çš„åˆ—è¡¨å¯ä¾›å‚è€ƒ [Roles list](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles)

- `getByLabelText`

è¿™æ˜¯æŸ¥è¯¢å¸¦`label`çš„è¡¨å•å…ƒç´ çš„é¦–é€‰é¡¹

- `getByPlaceholderText`

è¿™æ˜¯æŸ¥è¯¢è¡¨å•å…ƒç´ çš„ä¸€ä¸ªä»£æ›¿æ–¹æ¡ˆ

- `getByText`

å®ƒå¯¹è¡¨å•æ²¡æœ‰ç”¨ï¼Œä½†è¿™æ˜¯æ‰¾åˆ°å¤§å¤šæ•°éäº¤äº’å¼å…ƒç´ ï¼ˆä¾‹å¦‚ `div` å’Œ `span`ï¼‰çš„ç¬¬ä¸€æ–¹æ³•

#### 2. Semantic Queriesï¼ˆè¯­ä¹‰æŸ¥è¯¢)

- `getByAltText`

å¦‚æœæˆ‘ä»¬æŸ¥è¯¢çš„å…ƒç´ æ”¯æŒ alt textï¼ˆä¾‹å¦‚ img area inputï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å®ƒæ¥è¿›è¡ŒæŸ¥è¯¢

- `getByTitle`

é€šè¿‡ title å±æ€§æŸ¥è¯¢ï¼Œä½†æ˜¯æ³¨æ„ï¼Œä¸€èˆ¬é€šè¿‡å±å¹•æŸ¥çœ‹é¡µé¢çš„ç”¨æˆ·æ˜¯æ— æ³•ç›´æ¥çœ‹åˆ° title çš„

#### 3. Test IDs

- `getByTestId`

ç”¨äºæŸ¥è¯¢æ— æ³•é€šè¿‡ Role æˆ–è€… Text åŒ¹é…åˆ°çš„å…ƒç´ ï¼Œæ˜¯æœ€åçš„é€‰æ‹©ï¼Œéœ€è¦åœ¨å…ƒç´ ä¸Šæ·»åŠ `data-testid`å±æ€§
