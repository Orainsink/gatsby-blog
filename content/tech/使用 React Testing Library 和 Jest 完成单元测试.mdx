---
title: ä½¿ç”¨React Testing Libraryå’ŒJestå®Œæˆå•å…ƒæµ‹è¯•[è½¬è½½]
date: 2021-06-23 19:33:07
description:
tags: [æµ‹è¯•, react]
categories: tech
---

> [ä½¿ç”¨ React Testing Library å’Œ Jest å®Œæˆå•å…ƒæµ‹è¯•](https://segmentfault.com/a/1190000022054307)
>
> [**joking_zhang**](https://segmentfault.com/u/joking_zhang)å‘å¸ƒäº 2020-03-18
>
> è½¬è½½ä»¥è®°ç¬”è®°.

# éœ€è¦ä»€ä¹ˆæ ·çš„æµ‹è¯•

è½¯ä»¶æµ‹è¯•æ˜¯æœ‰çº§åˆ«çš„ï¼Œä¸‹é¢æ˜¯ã€ŠGoogle è½¯ä»¶æµ‹è¯•ä¹‹é“ã€‹ä¸€ä¹¦ä¸­ï¼Œå¯¹äºæµ‹è¯•è®¤è¯çº§åˆ«çš„å®šä¹‰ï¼Œæ‘˜å½•å¦‚ä¸‹ï¼š

- çº§åˆ« 1
  - ä½¿ç”¨æµ‹è¯•è¦†ç›–ç‡å·¥å…·ã€‚
  - ä½¿ç”¨æŒç»­é›†æˆã€‚
  - æµ‹è¯•åˆ†çº§ä¸ºå°å‹ã€ä¸­å‹ã€å¤§å‹ã€‚
  - åˆ›å»ºå†’çƒŸæµ‹è¯•é›†åˆï¼ˆä¸»æµç¨‹æµ‹è¯•ç”¨ä¾‹ï¼‰ã€‚
  - æ ‡è®°å“ªäº›æµ‹è¯•æ˜¯éç¡®å®šæ€§çš„æµ‹è¯•ï¼ˆæµ‹è¯•ç»“æœä¸å”¯ä¸€ï¼‰ã€‚
- çº§åˆ« 2
  - å¦‚æœæœ‰æµ‹è¯•è¿è¡Œç»“æœä¸ºçº¢è‰²ï¼ˆå¤±è´¥ âŒï¼‰å°±ä¸ä¼šå‘å¸ƒã€‚
  - æ¯æ¬¡ä»£ç æäº¤ä¹‹å‰éƒ½è¦æ±‚é€šè¿‡å†’çƒŸæµ‹è¯•ã€‚ï¼ˆè‡ªæµ‹ï¼Œç®€å•èµ°ä¸‹ä¸»æµç¨‹ï¼‰
  - å„ç§ç±»å‹çš„æ•´ä½“ä»£ç è¦†ç›–ç‡è¦å¤§äº 50%ã€‚
  - å°å‹æµ‹è¯•çš„è¦†ç›–ç‡è¦å¤§äº 10%ã€‚
- çº§åˆ« 3
  - æ‰€æœ‰é‡è¦çš„ä»£ç å˜æ›´éƒ½è¦ç»è¿‡æµ‹è¯•ã€‚
  - å°å‹æµ‹è¯•çš„è¦†ç›–ç‡å¤§äº 50%ã€‚
  - æ–°å¢é‡è¦åŠŸèƒ½éƒ½è¦é€šè¿‡é›†æˆæµ‹è¯•çš„éªŒè¯ã€‚
- çº§åˆ« 4
  - åœ¨æäº¤ä»»ä½•æ–°ä»£ç ä¹‹å‰éƒ½ä¼šè‡ªåŠ¨è¿è¡Œå†’çƒŸæµ‹è¯•ã€‚
  - å†’çƒŸæµ‹è¯•å¿…é¡»åœ¨ 30 åˆ†é’Ÿå†…è¿è¡Œå®Œæ¯•ã€‚
  - æ²¡æœ‰ä¸ç¡®å®šæ€§çš„æµ‹è¯•ã€‚
  - æ€»ä½“æµ‹è¯•è¦†ç›–ç‡åº”è¯¥ä¸å°äº 40%ã€‚
  - å°å‹æµ‹è¯•çš„ä»£ç è¦†ç›–ç‡åº”è¯¥ä¸å°äº 25%ã€‚
  - æ‰€æœ‰é‡è¦çš„åŠŸèƒ½éƒ½åº”è¯¥è¢«é›†æˆæµ‹è¯•éªŒè¯åˆ°ã€‚
- çº§åˆ« 5
  - å¯¹æ¯ä¸€ä¸ªé‡è¦çš„ç¼ºé™·ä¿®å¤éƒ½è¦å¢åŠ ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸ä¹‹å¯¹åº”ã€‚
  - ç§¯æä½¿ç”¨å¯ç”¨çš„ä»£ç åˆ†æå·¥å…·ã€‚
  - æ€»ä½“æµ‹è¯•è¦†ç›–ç‡ä¸ä½äº 60%ã€‚
  - å°å‹æµ‹è¯•ä»£ç è¦†ç›–ç‡åº”è¯¥ä¸å°äº 40%ã€‚

> å°å‹æµ‹è¯•ï¼Œé€šå¸¸ä¹Ÿå«å•å…ƒæµ‹è¯•ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯è‡ªåŠ¨åŒ–å®ç°çš„ã€‚ç”¨äºéªŒè¯ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Œç»„ä»¶ï¼Œç‹¬ç«‹åŠŸèƒ½æ¨¡å—æ˜¯å¦å¯ä»¥æŒ‰ç…§é¢„æœŸçš„æ–¹å¼è¿è¡Œã€‚

è€Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œé‡è¦çš„æ˜¯è¿›è¡Œäº†æµ‹è¯•çš„åŠ¨ä½œã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦å›´ç»•ç€**React ç»„ä»¶å•å…ƒæµ‹è¯•**å±•å¼€çš„ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†è®©å¼€å‘äººå‘˜å¯ä»¥ç«™åœ¨ä½¿ç”¨è€…çš„è§’åº¦è€ƒè™‘é—®é¢˜ã€‚é€šè¿‡æµ‹è¯•çš„æ‰‹æ®µï¼Œç¡®ä¿ç»„ä»¶çš„æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½å¯ä»¥æ­£å¸¸çš„è¿è¡Œï¼Œå…³æ³¨è´¨é‡ï¼Œè€Œä¸æ˜¯è®©ç”¨æˆ·æ¥å¸®ä½ æµ‹è¯•ã€‚

åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œä¸€å®šä¼šå¯¹ä¹‹å‰çš„ä»£ç åå¤è¿›è¡Œè°ƒæ•´ï¼Œè™½ç„¶è¿‡ç¨‹æ¯”è¾ƒç—›è‹¦ï¼Œå¯ç»„ä»¶çš„è´¨é‡ï¼Œä¹Ÿåœ¨ä¸€ç‚¹ä¸€ç‚¹çš„æé«˜ã€‚

# å¯éµå¾ªçš„ç®€å•è§„åˆ™

ä¹Ÿè®¸ä¸Šæ–‡ä¸­ä½¿ç”¨ `React Testing Library` ç¼–å†™çš„å•å…ƒæµ‹è¯•ç¤ºä¾‹ï¼Œè¿˜ä¼šç»™äººä¸€ç§ä¸€å¤´é›¾æ°´çš„æ„Ÿè§‰ã€‚ä¸‹é¢ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ **AAA** æ¨¡å¼æ¥ä¸€æ­¥ä¸€æ­¥çš„æ‹†è§£è¿™éƒ¨åˆ†ä»£ç ã€‚

**AAA æ¨¡å¼**ï¼šç¼–æ’ï¼ˆArrangeï¼‰ï¼Œæ‰§è¡Œï¼ˆActï¼‰ï¼Œæ–­è¨€ï¼ˆAssertï¼‰ã€‚

å‡ ä¹æ‰€æœ‰çš„æµ‹è¯•éƒ½æ˜¯è¿™æ ·å†™çš„ã€‚é¦–å…ˆï¼Œæ‚¨è¦**ç¼–æ’(åˆå§‹åŒ–)**æ‚¨çš„ä»£ç ï¼Œä»¥ä¾¿ä¸ºæ¥ä¸‹æ¥çš„æ­¥éª¤åšå¥½ä¸€åˆ‡å‡†å¤‡ã€‚ç„¶åï¼Œæ‚¨**æ‰§è¡Œ**ç”¨æˆ·åº”è¯¥æ‰§è¡Œçš„æ­¥éª¤(ä¾‹å¦‚å•å‡»)ã€‚æœ€åï¼Œæ‚¨å¯¹åº”è¯¥å‘ç”Ÿçš„äº‹æƒ…è¿›è¡Œ**æ–­è¨€**ã€‚

```jsx
import React from 'react';
import { render, fireEvent } from '@testing-library/react';

import Counter from './app';

describe('<Counter />', () => {
  it('properly increments the counter', () => {
    // Arrange
    const { getByText } = render(<Counter />);
    const counter = getByText('0');
    const incrementButton = getByText('+');
    const decrementButton = getByText('-');

    // Act
    fireEvent.click(incrementButton);
    // Assert
    expect(counter.textContent).toEqual('1');

    // Act
    fireEvent.click(decrementButton);
    // Assert
    expect(counter.textContent).toEqual('0');
  });
});
```

# ç¼–æ’ï¼ˆArrangeï¼‰

åœ¨ç¼–æ’è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆ 2 é¡¹ä»»åŠ¡ï¼š

- æ¸²æŸ“ç»„ä»¶
- è·å–æ‰€éœ€çš„ DOM çš„ä¸åŒå…ƒç´ ã€‚

æ¸²æŸ“ç»„ä»¶å¯ä»¥ä½¿ç”¨ RTL's API çš„ `render` æ–¹æ³•å®Œæˆã€‚ç­¾åå¦‚ä¸‹ï¼š

```jsx
function render(
  ui: React.ReactElement,
  options?: Omit<RenderOptions, 'queries'>
): RenderResult
```

`ui` æ˜¯ä½ è¦åŠ è½½çš„ç»„ä»¶ã€‚`options` é€šå¸¸ä¸éœ€è¦æŒ‡å®šé€‰é¡¹ã€‚[å®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œ](https://testing-library.com/docs/react-testing-library/api#render-options)ï¼Œå¦‚æœè¦æŒ‡å®šçš„è¯ï¼Œå¦‚ä¸‹å€¼æ˜¯å¯¹å®˜æ–¹æ–‡æ¡£çš„ç®€å•æ‘˜å½•ï¼š

- containerï¼šReact Testing åº“å°†åˆ›å»ºä¸€ä¸ª div å¹¶å°†è¯¥ div é™„åŠ åˆ°æ–‡æ¡£ä¸­ã€‚è€Œé€šè¿‡è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥è‡ªå®šä¹‰å®¹å™¨ã€‚
- baseElementï¼š

å¦‚æœæŒ‡å®šäº†å®¹å™¨ï¼Œåˆ™æ­¤å€¼é»˜è®¤ä¸ºè¯¥å€¼ï¼Œå¦åˆ™æ­¤å€¼é»˜è®¤ä¸º document.documentElementã€‚è¿™å°†ç”¨ä½œæŸ¥è¯¢çš„åŸºæœ¬å…ƒç´ ï¼Œä»¥åŠåœ¨ä½¿ç”¨ debug()æ—¶æ‰“å°çš„å†…å®¹ã€‚

- hydrateï¼šç”¨äºæœåŠ¡ç«¯æ¸²æŸ“ï¼Œä½¿ç”¨ `ReactDOM.hydrate` åŠ è½½ä½ çš„ç»„ä»¶ã€‚
- wrapperï¼šä¼ é€’ä¸€ä¸ªç»„ä»¶ä½œä¸ºåŒ…è£¹å±‚ï¼Œå°†æˆ‘ä»¬è¦æµ‹è¯•çš„ç»„ä»¶æ¸²æŸ“åœ¨å…¶ä¸­ã€‚è¿™é€šå¸¸ç”¨äºåˆ›å»ºå¯ä»¥é‡ç”¨çš„è‡ªå®šä¹‰ render å‡½æ•°ï¼Œä»¥ä¾¿æä¾›å¸¸ç”¨æ•°æ®ã€‚
- queriesï¼šæŸ¥è¯¢ç»‘å®šã€‚é™¤éåˆå¹¶ï¼Œå¦åˆ™å°†è¦†ç›– DOM æµ‹è¯•åº“ä¸­çš„é»˜è®¤è®¾ç½®ã€‚

åŸºæœ¬ä¸Šï¼Œè¿™ä¸ªå‡½æ•°æ‰€åšçš„å°±æ˜¯ä½¿ç”¨ ReactDOM å‘ˆç°ç»„ä»¶ã€‚åœ¨ç›´æ¥é™„åŠ åˆ° document.body çš„æ–°åˆ›å»ºçš„ div ä¸­å‘ˆç°(æˆ–ä¸ºæœåŠ¡å™¨ç«¯å‘ˆç°æä¾›æ°´åˆç‰©)ã€‚å› æ­¤ï¼Œå¯ä»¥ä» DOM æµ‹è¯•åº“å’Œå…¶ä»–ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•(å¦‚ debugã€rerender æˆ– unmount)è·å¾—å¤§é‡æŸ¥è¯¢ã€‚

æ–‡æ¡£ï¼š[https://testing-library.com/d...](https://testing-library.com/docs/dom-testing-library/api-queries#queries)

ä½†ä½ å¯èƒ½ä¼šæƒ³ï¼Œè¿™äº›é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢?æœ‰äº›å®ç”¨ç¨‹åºå…è®¸æ‚¨åƒç”¨æˆ·é‚£æ ·æŸ¥è¯¢ DOM:é€šè¿‡æ ‡ç­¾æ–‡æœ¬ã€å ä½ç¬¦å’Œæ ‡é¢˜æŸ¥æ‰¾å…ƒç´ ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ¥è‡ªæ–‡æ¡£çš„æŸ¥è¯¢ç¤ºä¾‹:

- getByLabelText:æœç´¢ä¸ä½œä¸ºå‚æ•°ä¼ é€’çš„ç»™å®šæ–‡æœ¬åŒ¹é…çš„æ ‡ç­¾ï¼Œç„¶åæŸ¥æ‰¾ä¸è¯¥æ ‡ç­¾å…³è”çš„å…ƒç´ ã€‚
- getByText:æœç´¢å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹çš„æ‰€æœ‰å…ƒç´ ï¼Œå…¶ä¸­çš„ textContent ä¸ä½œä¸ºå‚æ•°ä¼ é€’çš„ç»™å®šæ–‡æœ¬åŒ¹é…ã€‚
- getByTitle:è¿”å›å…·æœ‰ä¸ä½œä¸ºå‚æ•°ä¼ é€’çš„ç»™å®šæ–‡æœ¬åŒ¹é…çš„ title å±æ€§çš„å…ƒç´ ã€‚
- getByPlaceholderText:æœç´¢å…·æœ‰å ä½ç¬¦å±æ€§çš„æ‰€æœ‰å…ƒç´ ï¼Œå¹¶æ‰¾åˆ°ä¸ä½œä¸ºå‚æ•°ä¼ é€’çš„ç»™å®šæ–‡æœ¬ç›¸åŒ¹é…çš„å…ƒç´ ã€‚

ä¸€ä¸ªç‰¹å®šçš„æŸ¥è¯¢æœ‰å¾ˆå¤šå˜ä½“:

- getBy:è¿”å›æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ªåŒ¹é…èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„å…ƒç´ æˆ–æ‰¾åˆ°å¤šä¸ªåŒ¹é…ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚
- getAllBy:è¿”å›ä¸€ä¸ªæŸ¥è¯¢ä¸­æ‰€æœ‰åŒ¹é…èŠ‚ç‚¹çš„æ•°ç»„ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„å…ƒç´ ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚
- queryBy:è¿”å›æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ªåŒ¹é…èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„å…ƒç´ ï¼Œåˆ™è¿”å› nullã€‚è¿™å¯¹äºæ–­è¨€ä¸å­˜åœ¨çš„å…ƒç´ éå¸¸æœ‰ç”¨ã€‚
- queryAllBy:è¿”å›ä¸€ä¸ªæŸ¥è¯¢çš„æ‰€æœ‰åŒ¹é…èŠ‚ç‚¹çš„æ•°ç»„ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„å…ƒç´ ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºæ•°ç»„([])ã€‚
- findByï¼šè¿”å›ä¸€ä¸ª promiseï¼Œè¯¥ promise å°†åœ¨æ‰¾åˆ°ä¸ç»™å®šæŸ¥è¯¢åŒ¹é…çš„å…ƒç´ æ—¶è§£æã€‚å¦‚æœæœªæ‰¾åˆ°ä»»ä½•å…ƒç´ ï¼Œæˆ–è€…åœ¨é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 4500 æ¯«ç§’åæ‰¾åˆ°äº†å¤šä¸ªå…ƒç´ ï¼Œåˆ™æ‰¿è¯ºå°†è¢«æ‹’ç»ã€‚
- findAllByï¼šè¿”å›ä¸€ä¸ª promiseï¼Œå½“æ‰¾åˆ°ä¸ç»™å®šæŸ¥è¯¢åŒ¹é…çš„ä»»ä½•å…ƒç´ æ—¶ï¼Œè¯¥ promise å°†è§£æä¸ºå…ƒç´ æ•°ç»„ã€‚

# æ‰§è¡Œï¼ˆActï¼‰

ç°åœ¨ä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¡ŒåŠ¨äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶é—´ä½¿ç”¨äº†æ¥è‡ª DOM æµ‹è¯•åº“çš„ fireEventï¼Œå…¶ç­¾åå¦‚ä¸‹:

```jsx
fireEvent(node: HTMLElement, event: Event)
```

ç®€å•åœ°è¯´ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ª DOM èŠ‚ç‚¹(æ‚¨å¯ä»¥ä½¿ç”¨ä¸Šé¢çœ‹åˆ°çš„æŸ¥è¯¢æŸ¥è¯¢å®ƒ!)å¹¶è§¦å‘ DOM äº‹ä»¶ï¼Œå¦‚å•å‡»ã€ç„¦ç‚¹ã€æ›´æ”¹ç­‰ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°è®¸å¤šå…¶ä»–å¯ä»¥è°ƒåº¦çš„äº‹ä»¶ã€‚

æˆ‘ä»¬çš„ä¾‹å­ç›¸å½“ç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯æƒ³ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€:

```jsx
fireEvent.click(incrementButton);
// OR
fireEvent.click(decrementButton);
```

# æ–­è¨€ï¼ˆAssertï¼‰

æ¥ä¸‹æ¥æ˜¯æœ€åä¸€éƒ¨åˆ†ã€‚è§¦å‘äº‹ä»¶é€šå¸¸ä¼šè§¦å‘åº”ç”¨ç¨‹åºä¸­çš„ä¸€äº›æ›´æ”¹ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æ‰§è¡Œä¸€äº›æ–­è¨€æ¥ç¡®ä¿è¿™äº›æ›´æ”¹å‘ç”Ÿã€‚åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­ï¼Œè¿™æ ·åšçš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯ç¡®ä¿å‘ˆç°ç»™ç”¨æˆ·çš„è®¡æ•°å·²ç»æ›´æ”¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€æ–­è¨€ textContent å±æ€§çš„è®¡æ•°å™¨æ˜¯é€’å¢æˆ–é€’å‡:

```jsx
expect(counter.textContent).toEqual('1');
expect(counter.textContent).toEqual('0');
```

æ­å–œä½ ï¼Œåˆ°è¿™é‡Œä½ å·²ç»å°†æˆ‘ä»¬çš„ç¤ºä¾‹æ‹†è§£æˆåŠŸã€‚ ğŸ¥³

> æ³¨æ„:è¿™ä¸ª AAA æ¨¡å¼å¹¶ä¸ç‰¹å®šäºæµ‹è¯•åº“ã€‚äº‹å®ä¸Šï¼Œå®ƒç”šè‡³æ˜¯ä»»ä½•æµ‹è¯•ç”¨ä¾‹çš„ä¸€èˆ¬ç»“æ„ã€‚æˆ‘åœ¨è¿™é‡Œå‘æ‚¨å±•ç¤ºè¿™ä¸ªæ˜¯å› ä¸ºæˆ‘å‘ç°æµ‹è¯•åº“å¦‚ä½•æ–¹ä¾¿åœ°åœ¨æ¯ä¸ªéƒ¨åˆ†ä¸­ç¼–å†™æµ‹è¯•æ˜¯ä¸€ä»¶å¾ˆæœ‰è¶£çš„äº‹æƒ…ã€‚

# 8 ä¸ªå…¸å‹çš„ä¾‹å­

åˆ°è¿™é‡Œï¼Œå°±è¿›å…¥å®æˆ˜é˜¶æ®µäº†ï¼Œæ¥ä¸‹æ¥è¯·å…ˆä¸‹è½½ç¤ºä¾‹ï¼š[rts-guide-demo](https://github.com/jokingzhang/rts-guide-demo) ã€‚

å®‰è£…ä¾èµ–çš„åŒæ—¶å¯ä»¥ç®€å•çœ‹ä¸‹æˆ‘ä»¬çš„é¡¹ç›®ã€‚`src/test` ç›®å½•ä¸‹å­˜æ”¾äº†æ‰€æœ‰å•å…ƒæµ‹è¯•ç›¸å…³çš„æ–‡ä»¶ã€‚è®©æˆ‘ä»¬æ¸…ç©ºè¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå†å°†ä¸‹é¢çš„ç¤ºä¾‹ä¾æ¬¡æ‰‹è¿‡ä¸€éã€‚ğŸ™ï¼ˆCV ä¹Ÿæ˜¯å¯ä»¥çš„ ğŸ‘Œï¼‰

## 1.å¦‚ä½•åˆ›å»ºæµ‹è¯•å¿«ç…§

å¿«ç…§ï¼Œé¡¾åæ€ä¹‰ï¼Œå…è®¸æˆ‘ä»¬ä¿å­˜ç»™å®šç»„ä»¶çš„å¿«ç…§ã€‚å½“æ‚¨è¿›è¡Œæ›´æ–°æˆ–é‡æ„ï¼Œå¹¶å¸Œæœ›è·å–æˆ–æ¯”è¾ƒæ›´æ”¹æ—¶ï¼Œå®ƒä¼šæä¾›å¾ˆå¤šå¸®åŠ©ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ `App.js` æ–‡ä»¶çš„å¿«ç…§ã€‚

### App.test.js

```jsx
import React from 'react';
import { render, cleanup } from '@testing-library/react';
import App from '../App';

afterEach(cleanup);

it('should take a snapshot', () => {
  const { asFragment } = render(<App />);

  expect(asFragment()).toMatchSnapshot();
});
```

è¦è·å–å¿«ç…§ï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»å¯¼å…¥ `render` å’Œ `cleanup` ã€‚è¿™ä¸¤ç§æ–¹æ³•å°†åœ¨æœ¬æ–‡ä¸­å¤§é‡ä½¿ç”¨ã€‚

`render`ï¼Œé¡¾åæ€ä¹‰ï¼Œæœ‰åŠ©äºæ¸²æŸ“ React ç»„ä»¶ã€‚`cleanup` ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™ `afterEach` ï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡æµ‹è¯•åæ¸…ç†æ‰€æœ‰ä¸œè¥¿ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `render` å‘ˆç° App ç»„ä»¶ï¼Œå¹¶ä»æ–¹æ³•ä¸­è·å– `asFragment` ä½œä¸ºè¿”å›å€¼ã€‚æœ€åï¼Œç¡®ä¿ App ç»„ä»¶çš„ç‰‡æ®µä¸å¿«ç…§åŒ¹é…ã€‚

ç°åœ¨ï¼Œè¦è¿è¡Œæµ‹è¯•ï¼Œæ‰“å¼€æ‚¨çš„ç»ˆç«¯å¹¶å¯¼èˆªåˆ°é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```shell
npm test
```

å› æ­¤ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ `__snapshots__` å’Œä¸€ä¸ªæ–‡ä»¶ `App.test.js`:

### App.test.js.snap

```jsx
// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`should take a snapshot 1`] = `
<DocumentFragment>
  <div
    class="App"
  >
    <h1>
      Testing Updated
    </h1>
  </div>
</DocumentFragment>
`;
```

å¦‚æœï¼Œä½ åœ¨ `App.js` ä¸­åšå‡ºæ›´æ”¹ï¼Œæµ‹è¯•å°†å¤±è´¥ï¼Œå› ä¸ºå¿«ç…§å°†ä¸å†åŒ¹é…ã€‚æ›´æ–°å¿«ç…§å¯ä»¥æŒ‰ `u` ï¼Œæˆ–è€…å°†å¯¹åº”å¿«ç…§æ–‡ä»¶åˆ é™¤å³å¯ã€‚

## 2.æµ‹è¯• DOM å…ƒç´ 

è¦æµ‹è¯• DOM å…ƒç´ ï¼Œé¦–å…ˆå¿…é¡»æŸ¥çœ‹`TestElements.js`æ–‡ä»¶ã€‚

### TestElements.js

```jsx
import React from 'react';

const TestElements = () => {
  const [counter, setCounter] = React.useState(0);

  return (
    <>
      <h1 data-testid="counter">{counter}</h1>
      <button data-testid="button-up" onClick={() => setCounter(counter + 1)}>
        {' '}
        Up
      </button>
      <button
        disabled
        data-testid="button-down"
        onClick={() => setCounter(counter - 1)}
      >
        Down
      </button>
    </>
  );
};

export default TestElements;
```

åœ¨è¿™é‡Œï¼Œæ‚¨å”¯ä¸€éœ€è¦ä¿ç•™çš„æ˜¯ `data-testid` ã€‚å®ƒå°†ç”¨äºä»æµ‹è¯•æ–‡ä»¶ä¸­é€‰æ‹©è¿™äº›å…ƒç´ ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å®Œæˆå•å…ƒæµ‹è¯•:

æµ‹è¯•è®¡æ•°å™¨æ˜¯å¦ä¸º 0ï¼Œä»¥åŠæŒ‰é’®çš„ç¦ç”¨çŠ¶æ€:

### TestElements.test.js

```jsx
import React from 'react';
import '@testing-library/jest-dom/extend-expect';
import { render, cleanup } from '@testing-library/react';
import TestElements from '../components/TestElements';

afterEach(cleanup);

it('should equal to 0', () => {
  const { getByTestId } = render(<TestElements />);
  expect(getByTestId('counter')).toHaveTextContent(0);
});

it('should be enabled', () => {
  const { getByTestId } = render(<TestElements />);
  expect(getByTestId('button-up')).not.toHaveAttribute('disabled');
});

it('should be disabled', () => {
  const { getByTestId } = render(<TestElements />);
  expect(getByTestId('button-down')).toBeDisabled();
});
```

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¯­æ³•ä¸å‰é¢çš„æµ‹è¯•éå¸¸ç›¸ä¼¼ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯,æˆ‘ä»¬ä½¿ç”¨ `getByTestId` é€‰æ‹©å¿…è¦çš„å…ƒç´ (æ ¹æ® `data-testid` )å¹¶æ£€æŸ¥æ˜¯å¦é€šè¿‡äº†æµ‹è¯•ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æ£€æŸ¥ `<h1 data-testid="counter">{ counter }</h1>` ä¸­çš„æ–‡æœ¬å†…å®¹æ˜¯å¦ç­‰äº 0ã€‚

è¿™é‡Œ,åƒå¾€å¸¸ä¸€æ ·,æˆ‘ä»¬ä½¿ç”¨ `getByTestId` é€‰æ‹©å…ƒç´ å’Œæ£€æŸ¥ç¬¬ä¸€ä¸ªæµ‹è¯•å¦‚æœæŒ‰é’®ç¦ç”¨å±æ€§ã€‚å¯¹äºç¬¬äºŒä¸ªï¼Œå¦‚æœæŒ‰é’®æ˜¯å¦è¢«ç¦ç”¨ã€‚

å¦‚æœæ‚¨ä¿å­˜æ–‡ä»¶æˆ–åœ¨ç»ˆç«¯çº±çº¿æµ‹è¯•ä¸­å†æ¬¡è¿è¡Œï¼Œæµ‹è¯•å°†é€šè¿‡ã€‚

## 3.æµ‹è¯•äº‹ä»¶

åœ¨ç¼–å†™å•å…ƒæµ‹è¯•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹ `TestEvents.js` æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚

```jsx
import React from 'react';

const TestEvents = () => {
  const [counter, setCounter] = React.useState(0);

  return (
    <>
      <h1 data-testid="counter">{counter}</h1>
      <button data-testid="button-up" onClick={() => setCounter(counter + 1)}>
        {' '}
        Up
      </button>
      <button data-testid="button-down" onClick={() => setCounter(counter - 1)}>
        Down
      </button>
    </>
  );
};

export default TestEvents;
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç¼–å†™æµ‹è¯•ã€‚

å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæµ‹è¯•è®¡æ•°å™¨çš„å¢å‡æ˜¯å¦æ­£ç¡®:

```jsx
import React from 'react';
import '@testing-library/jest-dom/extend-expect';
import { render, cleanup, fireEvent } from '@testing-library/react';
import TestEvents from '../components/TestEvents';

afterEach(cleanup);

it('increments counter', () => {
  const { getByTestId } = render(<TestEvents />);

  fireEvent.click(getByTestId('button-up'));

  expect(getByTestId('counter')).toHaveTextContent('1');
});

it('decrements counter', () => {
  const { getByTestId } = render(<TestEvents />);

  fireEvent.click(getByTestId('button-down'));

  expect(getByTestId('counter')).toHaveTextContent('-1');
});
```

å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†é¢„æœŸçš„æ–‡æœ¬å†…å®¹ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæµ‹è¯•éå¸¸ç›¸ä¼¼ã€‚

ç¬¬ä¸€ä¸ªæµ‹è¯•ä½¿ç”¨ `fireEvent.click()` è§¦å‘ä¸€ä¸ª `click` äº‹ä»¶ï¼Œæ£€æŸ¥å•å‡»æŒ‰é’®æ—¶è®¡æ•°å™¨æ˜¯å¦å¢åŠ åˆ° 1ã€‚

ç¬¬äºŒä¸ªæ£€æŸ¥å½“ç‚¹å‡»æŒ‰é’®æ—¶è®¡æ•°å™¨æ˜¯å¦å‡ä¸º-1ã€‚

`fireEvent` æœ‰å‡ ä¸ªå¯ä»¥ç”¨æ¥æµ‹è¯•äº‹ä»¶çš„æ–¹æ³•ï¼Œå› æ­¤æ‚¨å¯ä»¥è‡ªç”±åœ°æ·±å…¥æ–‡æ¡£äº†è§£æ›´å¤šä¿¡æ¯ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•æµ‹è¯•äº‹ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­å­¦ä¹ å¦‚ä½•å¤„ç†å¼‚æ­¥æ“ä½œã€‚

## 4. æµ‹è¯•å¼‚æ­¥æ“ä½œ

å¼‚æ­¥æ“ä½œæ˜¯éœ€è¦æ—¶é—´æ‰èƒ½å®Œæˆçš„æ“ä½œã€‚å®ƒå¯ä»¥æ˜¯ HTTP è¯·æ±‚ã€è®¡æ—¶å™¨ç­‰ç­‰ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ `TestAsync.js` æ–‡ä»¶ã€‚

```jsx
import React from 'react';

const TestAsync = () => {
  const [counter, setCounter] = React.useState(0);

  const delayCount = () =>
    setTimeout(() => {
      setCounter(counter + 1);
    }, 500);

  return (
    <>
      <h1 data-testid="counter">{counter}</h1>
      <button data-testid="button-up" onClick={delayCount}>
        {' '}
        Up
      </button>
      <button data-testid="button-down" onClick={() => setCounter(counter - 1)}>
        Down
      </button>
    </>
  );
};

export default TestAsync;
```

è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ `setTimeout()` å°†é€’å¢äº‹ä»¶å»¶è¿Ÿ 0.5 ç§’ã€‚

æµ‹è¯•è®¡æ•°å™¨åœ¨ 0.5 ç§’ååˆ¤æ–­æ˜¯å¦å¢åŠ :

### TestAsync.test.js

```jsx
import React from 'react';
import '@testing-library/jest-dom/extend-expect';
import {
  render,
  cleanup,
  fireEvent,
  waitForElement,
} from '@testing-library/react';
import TestAsync from '../components/TestAsync';

afterEach(cleanup);

it('increments counter after 0.5s', async () => {
  const { getByTestId, getByText } = render(<TestAsync />);

  fireEvent.click(getByTestId('button-up'));

  const counter = await waitForElement(() => getByText('1'));

  expect(counter).toHaveTextContent('1');
});
```

è¦æµ‹è¯•é€’å¢äº‹ä»¶ï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»ä½¿ç”¨ `async/await` æ¥å¤„ç†æ“ä½œï¼Œå› ä¸ºå¦‚å‰æ‰€è¿°ï¼Œå®Œæˆå®ƒéœ€è¦æ—¶é—´ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ–°çš„åŠ©æ‰‹æ–¹æ³• `getByText()`ã€‚è¿™ç±»ä¼¼äº`getByTestId()`ã€‚`getByText()`é€‰æ‹©æ–‡æœ¬å†…å®¹ï¼Œè€Œä¸æ˜¯ idã€‚

ç°åœ¨ï¼Œåœ¨å•å‡»æŒ‰é’®ä¹‹åï¼Œæˆ‘ä»¬ç­‰å¾… `waitForElement(() => getByText('1')` æ¥å¢åŠ è®¡æ•°å™¨ã€‚ä¸€æ—¦è®¡æ•°å™¨å¢åŠ åˆ° 1ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç§»åŠ¨åˆ°æ¡ä»¶å¹¶æ£€æŸ¥è®¡æ•°å™¨æ˜¯å¦ç­‰äº 1ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨è®©æˆ‘ä»¬è½¬å‘æ›´å¤æ‚çš„æµ‹è¯•ç”¨ä¾‹ã€‚

ä½ å‡†å¤‡å¥½äº†å—?

## 5.æµ‹è¯• React Redux

è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ `TestRedux.js` æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚

### TestRedux.js

```jsx
import React from 'react';
import { connect } from 'react-redux';

const TestRedux = ({ counter, dispatch }) => {
  const increment = () => dispatch({ type: 'INCREMENT' });
  const decrement = () => dispatch({ type: 'DECREMENT' });

  return (
    <>
      <h1 data-testid="counter">{counter}</h1>
      <button data-testid="button-up" onClick={increment}>
        Up
      </button>
      <button data-testid="button-down" onClick={decrement}>
        Down
      </button>
    </>
  );
};

export default connect((state) => ({ counter: state.count }))(TestRedux);
```

### store/reducer.js

```jsx
export const initialState = {
  count: 0,
};

export function reducer(state = initialState, action) {
  switch (action.type) {
    case 'INCREMENT':
      return {
        count: state.count + 1,
      };
    case 'DECREMENT':
      return {
        count: state.count - 1,
      };
    default:
      return state;
  }
}
```

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ã€‚
å®ƒåªæ˜¯ä¸€ä¸ªç”± `React Redux` å¤„ç†çš„åŸºæœ¬è®¡æ•°å™¨ç»„ä»¶ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥ç¼–å†™å•å…ƒæµ‹è¯•ã€‚

æµ‹è¯•åˆå§‹çŠ¶æ€æ˜¯å¦ä¸º 0:

```jsx
import React from 'react';
import '@testing-library/jest-dom/extend-expect';
import { createStore } from 'redux';
import { Provider } from 'react-redux';
import { render, cleanup, fireEvent } from '@testing-library/react';
import { initialState, reducer } from '../store/reducer';
import TestRedux from '../components/TestRedux';

const renderWithRedux = (
  component,
  { initialState, store = createStore(reducer, initialState) } = {}
) => {
  return {
    ...render(<Provider store={store}>{component}</Provider>),
    store,
  };
};

afterEach(cleanup);

it('checks initial state is equal to 0', () => {
  const { getByTestId } = renderWithRedux(<TestRedux />);
  expect(getByTestId('counter')).toHaveTextContent('0');
});

it('increments the counter through redux', () => {
  const { getByTestId } = renderWithRedux(<TestRedux />, {
    initialState: { count: 5 },
  });
  fireEvent.click(getByTestId('button-up'));
  expect(getByTestId('counter')).toHaveTextContent('6');
});

it('decrements the counter through redux', () => {
  const { getByTestId } = renderWithRedux(<TestRedux />, {
    initialState: { count: 100 },
  });
  fireEvent.click(getByTestId('button-down'));
  expect(getByTestId('counter')).toHaveTextContent('99');
});
```

æˆ‘ä»¬éœ€è¦å¯¼å…¥ä¸€äº›ä¸œè¥¿æ¥æµ‹è¯• `React Redux` ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†è‡ªå·±çš„åŠ©æ‰‹å‡½æ•° `renderWithRedux()` æ¥å‘ˆç°ç»„ä»¶ï¼Œå› ä¸ºå®ƒå°†è¢«å¤šæ¬¡ä½¿ç”¨ã€‚

`renderWithRedux()` ä½œä¸ºå‚æ•°æ¥æ”¶è¦å‘ˆç°çš„ç»„ä»¶ã€åˆå§‹çŠ¶æ€å’Œå­˜å‚¨ã€‚å¦‚æœæ²¡æœ‰å­˜å‚¨ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªæ–°çš„å­˜å‚¨ï¼Œå¦‚æœå®ƒæ²¡æœ‰æ¥æ”¶åˆå§‹çŠ¶æ€æˆ–å­˜å‚¨ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨`render()`æ¥å‘ˆç°ç»„ä»¶å¹¶å°†å­˜å‚¨ä¼ é€’ç»™æä¾›è€…ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å°†ç»„ä»¶ `TestRedux` ä¼ é€’ç»™ `renderWithRedux()` æ¥æµ‹è¯•è®¡æ•°å™¨æ˜¯å¦ç­‰äº 0ã€‚

æµ‹è¯•è®¡æ•°å™¨çš„å¢å‡æ˜¯å¦æ­£ç¡®:

ä¸ºäº†æµ‹è¯•é€’å¢å’Œé€’å‡äº‹ä»¶ï¼Œæˆ‘ä»¬å°†åˆå§‹çŠ¶æ€ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™`renderWithRedux()`ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å•å‡»æŒ‰é’®å¹¶æµ‹è¯•é¢„æœŸçš„ç»“æœæ˜¯å¦ç¬¦åˆæ¡ä»¶ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€èŠ‚å¹¶ä»‹ç» React Contextã€‚

## 6. æµ‹è¯• React Context

è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ `TextContext.js` æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚

```jsx
import React from 'react';

export const CounterContext = React.createContext();

const CounterProvider = () => {
  const [counter, setCounter] = React.useState(0);
  const increment = () => setCounter(counter + 1);
  const decrement = () => setCounter(counter - 1);

  return (
    <CounterContext.Provider value={{ counter, increment, decrement }}>
      <Counter />
    </CounterContext.Provider>
  );
};

export const Counter = () => {
  const { counter, increment, decrement } = React.useContext(CounterContext);
  return (
    <>
      <h1 data-testid="counter">{counter}</h1>
      <button data-testid="button-up" onClick={increment}>
        {' '}
        Up
      </button>
      <button data-testid="button-down" onClick={decrement}>
        Down
      </button>
    </>
  );
};

export default CounterProvider;
```

ç°åœ¨ï¼Œé€šè¿‡ React Context ç®¡ç†è®¡æ•°å™¨çŠ¶æ€ã€‚è®©æˆ‘ä»¬ç¼–å†™å•å…ƒæµ‹è¯•æ¥æ£€æŸ¥å®ƒæ˜¯å¦æŒ‰é¢„æœŸè¿è¡Œã€‚

æµ‹è¯•åˆå§‹çŠ¶æ€æ˜¯å¦ä¸º 0:

### TextContext.test.js

```jsx
import React from 'react';
import '@testing-library/jest-dom/extend-expect';
import { render, cleanup, fireEvent } from '@testing-library/react';
import CounterProvider, {
  CounterContext,
  Counter,
} from '../components/TestContext';

const renderWithContext = (component) => {
  return {
    ...render(
      <CounterProvider value={CounterContext}>{component}</CounterProvider>
    ),
  };
};

afterEach(cleanup);

it('checks if initial state is equal to 0', () => {
  const { getByTestId } = renderWithContext(<Counter />);
  expect(getByTestId('counter')).toHaveTextContent('0');
});

it('increments the counter', () => {
  const { getByTestId } = renderWithContext(<Counter />);

  fireEvent.click(getByTestId('button-up'));
  expect(getByTestId('counter')).toHaveTextContent('1');
});

it('decrements the counter', () => {
  const { getByTestId } = renderWithContext(<Counter />);

  fireEvent.click(getByTestId('button-down'));
  expect(getByTestId('counter')).toHaveTextContent('-1');
});
```

ä¸å‰é¢çš„ React Redux éƒ¨åˆ†ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªåŠ©æ‰‹å‡½æ•°`renderWithContext()`æ¥å‘ˆç°ç»„ä»¶ã€‚ä½†æ˜¯è¿™ä¸€æ¬¡ï¼Œå®ƒåªæ¥æ”¶ä½œä¸ºå‚æ•°çš„ç»„ä»¶ã€‚ä¸ºäº†åˆ›å»ºæ–°çš„ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬å°†`CounterContext`ä¼ é€’ç»™ Providerã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è®¡æ•°å™¨æœ€åˆæ˜¯å¦ç­‰äº 0ã€‚
é‚£ä¹ˆï¼Œè®¡æ•°å™¨çš„å¢å‡æ˜¯å¦æ­£ç¡®å‘¢ï¼Ÿ

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™é‡Œæˆ‘ä»¬è§¦å‘ä¸€ä¸ª `click` äº‹ä»¶æ¥æµ‹è¯•è®¡æ•°å™¨æ˜¯å¦æ­£ç¡®åœ°å¢åŠ åˆ° 1 å¹¶å‡å°‘åˆ°-1ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥è¿›å…¥ä¸‹ä¸€èŠ‚å¹¶ä»‹ç» React Routerã€‚

## 7. æµ‹è¯• React Router

è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ `TestRouter.js` æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚

### TestRouter.js

```jsx
import React from 'react';

import { Link, Route, Switch, useParams } from 'react-router-dom';

const About = () => <h1>About page</h1>;

const Home = () => <h1>Home page</h1>;

const Contact = () => {
  const { name } = useParams();

  return <h1 data-testid="contact-name">{name}</h1>;
};

const TestRouter = () => {
  const name = 'John Doe';
  return (
    <>
      <nav data-testid="navbar">
        <Link data-testid="home-link" to="/">
          Home
        </Link>
        <Link data-testid="about-link" to="/about">
          About
        </Link>
        <Link data-testid="contact-link" to={`/contact/${name}`}>
          Contact
        </Link>
      </nav>

      <Switch>
        <Route exact path="/" component={Home} />
        <Route path="/about" component={About} />
        <Route path="/about:name" component={Contact} />
      </Switch>
    </>
  );
};

export default TestRouter;
```

è¿™é‡Œï¼Œå°†æµ‹è¯•è·¯ç”±å¯¹åº”çš„é¡µé¢ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚

### TestRouter.test.js

```jsx
import React from 'react';
import '@testing-library/jest-dom/extend-expect';
import { Router } from 'react-router-dom';
import { render, fireEvent } from '@testing-library/react';
import { createMemoryHistory } from 'history';
import TestRouter from '../components/TestRouter';

const renderWithRouter = (component) => {
  const history = createMemoryHistory();
  return {
    ...render(<Router history={history}>{component}</Router>),
  };
};

it('should render the home page', () => {
  const { container, getByTestId } = renderWithRouter(<TestRouter />);
  const navbar = getByTestId('navbar');
  const link = getByTestId('home-link');

  expect(container.innerHTML).toMatch('Home page');
  expect(navbar).toContainElement(link);
});

it('should navigate to the about page', () => {
  const { container, getByTestId } = renderWithRouter(<TestRouter />);

  fireEvent.click(getByTestId('about-link'));

  expect(container.innerHTML).toMatch('About page');
});

it('should navigate to the contact page with the params', () => {
  const { container, getByTestId } = renderWithRouter(<TestRouter />);

  fireEvent.click(getByTestId('contact-link'));

  expect(container.innerHTML).toMatch('John Doe');
});
```

è¦æµ‹è¯• React Routerï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»æœ‰ä¸€ä¸ªå¯¼èˆªå†å²è®°å½•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ `createMemoryHistory()` æ¥åˆ›å»ºå¯¼èˆªå†å²ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨åŠ©æ‰‹å‡½æ•° `renderWithRouter()` æ¥å‘ˆç°ç»„ä»¶ï¼Œå¹¶å°†å†å²è®°å½•ä¼ é€’ç»™è·¯ç”±å™¨ç»„ä»¶ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬ç°åœ¨å°±å¯ä»¥æµ‹è¯•åœ¨å¼€å§‹æ—¶åŠ è½½çš„é¡µé¢æ˜¯å¦æ˜¯ä¸»é¡µã€‚ä»¥åŠå¯¼èˆªæ æ˜¯å¦åŠ è½½äº†é¢„æœŸçš„é“¾æ¥ã€‚

æµ‹è¯•å½“æˆ‘ä»¬ç‚¹å‡»é“¾æ¥æ—¶ï¼Œå®ƒæ˜¯å¦ç”¨å‚æ•°å¯¼èˆªåˆ°å…¶ä»–é¡µé¢:

ç°åœ¨ï¼Œè¦æ£€æŸ¥å¯¼èˆªæ˜¯å¦å·¥ä½œï¼Œæˆ‘ä»¬å¿…é¡»è§¦å‘å¯¼èˆªé“¾æ¥ä¸Šçš„å•å‡»äº‹ä»¶ã€‚

å¯¹äºç¬¬ä¸€ä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬æ£€æŸ¥å†…å®¹æ˜¯å¦ç­‰äº About é¡µé¢ä¸­çš„æ–‡æœ¬ï¼Œå¯¹äºç¬¬äºŒä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬æµ‹è¯•è·¯ç”±å‚æ•°å¹¶æ£€æŸ¥å®ƒæ˜¯å¦æ­£ç¡®é€šè¿‡ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿›å…¥æœ€åä¸€èŠ‚ï¼Œå­¦ä¹ å¦‚ä½•æµ‹è¯• Axios è¯·æ±‚ã€‚

## 8. æµ‹è¯• HTTP è¯·æ±‚

è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ `TestRouter.js` æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚

```jsx
import React from 'react';
import axios from 'axios';

const TestAxios = ({ url }) => {
  const [data, setData] = React.useState();

  const fetchData = async () => {
    const response = await axios.get(url);
    setData(response.data.greeting);
  };

  return (
    <>
      <button onClick={fetchData} data-testid="fetch-data">
        Load Data
      </button>
      {data ? (
        <div data-testid="show-data">{data}</div>
      ) : (
        <h1 data-testid="loading">Loading...</h1>
      )}
    </>
  );
};

export default TestAxios;
```

æ­£å¦‚æ‚¨åœ¨è¿™é‡Œçœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ç»„ä»¶ï¼Œå®ƒæœ‰ä¸€ä¸ªç”¨äºå‘å‡ºè¯·æ±‚çš„æŒ‰é’®ã€‚å¦‚æœæ•°æ®ä¸å¯ç”¨ï¼Œå®ƒå°†æ˜¾ç¤ºä¸€ä¸ªåŠ è½½æ¶ˆæ¯ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç¼–å†™æµ‹è¯•ã€‚

æ¥éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®è·å–å’Œæ˜¾ç¤º:

### TextAxios.test.js

```jsx
import React from 'react';
import '@testing-library/jest-dom/extend-expect';
import { render, waitForElement, fireEvent } from '@testing-library/react';
import axiosMock from 'axios';
import TestAxios from '../components/TestAxios';

jest.mock('axios');

it('should display a loading text', () => {
  const { getByTestId } = render(<TestAxios />);

  expect(getByTestId('loading')).toHaveTextContent('Loading...');
});

it('should load and display the data', async () => {
  const url = '/greeting';
  const { getByTestId } = render(<TestAxios url={url} />);

  axiosMock.get.mockResolvedValueOnce({
    data: { greeting: 'hello there' },
  });

  fireEvent.click(getByTestId('fetch-data'));

  const greetingData = await waitForElement(() => getByTestId('show-data'));

  expect(axiosMock.get).toHaveBeenCalledTimes(1);
  expect(axiosMock.get).toHaveBeenCalledWith(url);
  expect(greetingData).toHaveTextContent('hello there');
});
```

è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æœ‰ç‚¹ä¸åŒï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»å¤„ç† HTTP è¯·æ±‚ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨`jest.mock('axios')`çš„å¸®åŠ©ä¸‹æ¨¡æ‹Ÿ axios è¯·æ±‚ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ axiosMock å¹¶å¯¹å…¶åº”ç”¨`get()`æ–¹æ³•ã€‚æœ€åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Jest å‡½æ•°`mockResolvedValueOnce()`æ¥ä¼ é€’æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºå‚æ•°ã€‚

ç°åœ¨ï¼Œå¯¹äºç¬¬äºŒä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å•å‡»æŒ‰é’®æ¥è·å–æ•°æ®å¹¶ä½¿ç”¨`async/await`æ¥è§£æå®ƒã€‚ç°åœ¨æˆ‘ä»¬è¦æµ‹è¯•ä¸‰ä»¶äº‹:

- å¦‚æœ HTTP è¯·æ±‚å·²ç»æ­£ç¡®å®Œæˆ
- å¦‚æœä½¿ç”¨ url å®Œæˆäº† HTTP è¯·æ±‚
- å¦‚æœè·å–çš„æ•°æ®ç¬¦åˆæœŸæœ›ã€‚

å¯¹äºç¬¬ä¸€ä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬åªæ£€æŸ¥åŠ è½½æ¶ˆæ¯åœ¨æ²¡æœ‰æ•°æ®è¦æ˜¾ç¤ºæ—¶æ˜¯å¦æ˜¾ç¤ºã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº†å…«ä¸ªç®€å•çš„æ­¥éª¤æ¥æµ‹è¯•ä½ çš„ React åº”ç”¨ç¨‹åºã€‚

æ›´å¤šä¾‹å­è¯·å‚è€ƒ[React Testing Library å®˜æ–¹æ–‡æ¡£](https://testing-library.com/docs/example-input-event)ã€‚

# ç»“è¯­

`React Testing Library` æ˜¯ç”¨äºæµ‹è¯• React åº”ç”¨çš„ä¸€å¤§åˆ©å™¨ã€‚å®ƒä¸ºæˆ‘ä»¬æä¾›äº†è®¿é—® `jest-dom` åŒ¹é…å™¨çš„æœºä¼šï¼Œä»¥åŠæœ€ä½³å®è·µï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥æ›´æœ‰æ•ˆåœ°æµ‹è¯•æˆ‘ä»¬çš„ç»„ä»¶ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« æ˜¯æœ‰ç”¨çš„ï¼Œå®ƒå°†å¸®åŠ©æ‚¨åœ¨æœªæ¥æ„å»ºæ›´åŠ å¥å£®çš„ React åº”ç”¨ç¨‹åºã€‚
